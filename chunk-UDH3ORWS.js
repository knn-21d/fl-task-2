import{a as _t}from"./chunk-7VU2Y5KN.js";import{c as bt}from"./chunk-VKPAFQZU.js";import{d as ut}from"./chunk-NVDPKK7E.js";import{i as fs,k as us,o as wt,q as tt}from"./chunk-M2TXFAHB.js";import{D as It,H as Et,I as K,K as Ot,M as hs,N as gs,Z as Q,aa as ps,h as w,ia as J,j as Z,v as os}from"./chunk-X3ZV6C7C.js";import{a as st,b as it,g as C}from"./chunk-7IQ7MVDA.js";function zt(l,t,r){if(l&&l.length){let[e,s]=t,i=Math.PI/180*r,o=Math.cos(i),a=Math.sin(i);for(let c of l){let[n,h]=c;c[0]=(n-e)*o-(h-s)*a+e,c[1]=(n-e)*a+(h-s)*o+s}}}function Xe(l,t){return l[0]===t[0]&&l[1]===t[1]}function Ye(l,t,r,e=1){let s=r,i=Math.max(t,.1),o=l[0]&&l[0][0]&&typeof l[0][0]=="number"?[l]:l,a=[0,0];if(s)for(let n of o)zt(n,a,s);let c=function(n,h,p){let f=[];for(let x of n){let S=[...x];Xe(S[0],S[S.length-1])||S.push([S[0][0],S[0][1]]),S.length>2&&f.push(S)}let g=[];h=Math.max(h,.1);let u=[];for(let x of f)for(let S=0;S<x.length-1;S++){let b=x[S],v=x[S+1];if(b[1]!==v[1]){let k=Math.min(b[1],v[1]);u.push({ymin:k,ymax:Math.max(b[1],v[1]),x:k===b[1]?b[0]:v[0],islope:(v[0]-b[0])/(v[1]-b[1])})}}if(u.sort((x,S)=>x.ymin<S.ymin?-1:x.ymin>S.ymin?1:x.x<S.x?-1:x.x>S.x?1:x.ymax===S.ymax?0:(x.ymax-S.ymax)/Math.abs(x.ymax-S.ymax)),!u.length)return g;let y=[],m=u[0].ymin,d=0;for(;y.length||u.length;){if(u.length){let x=-1;for(let S=0;S<u.length&&!(u[S].ymin>m);S++)x=S;u.splice(0,x+1).forEach(S=>{y.push({s:m,edge:S})})}if(y=y.filter(x=>!(x.edge.ymax<=m)),y.sort((x,S)=>x.edge.x===S.edge.x?0:(x.edge.x-S.edge.x)/Math.abs(x.edge.x-S.edge.x)),(p!==1||d%h==0)&&y.length>1)for(let x=0;x<y.length;x+=2){let S=x+1;if(S>=y.length)break;let b=y[x].edge,v=y[S].edge;g.push([[Math.round(b.x),m],[Math.round(v.x),m]])}m+=p,y.forEach(x=>{x.edge.x=x.edge.x+p*x.edge.islope}),d++}return g}(o,i,e);if(s){for(let n of o)zt(n,a,-s);(function(n,h,p){let f=[];n.forEach(g=>f.push(...g)),zt(f,h,p)})(c,a,-s)}return c}function vt(l,t){var r;let e=t.hachureAngle+90,s=t.hachureGap;s<0&&(s=4*t.strokeWidth),s=Math.round(Math.max(s,.1));let i=1;return t.roughness>=1&&(((r=t.randomizer)===null||r===void 0?void 0:r.next())||Math.random())>.7&&(i=s),Ye(l,s,e,i||1)}var kt=class{constructor(t){this.helper=t}fillPolygons(t,r){return this._fillPolygons(t,r)}_fillPolygons(t,r){let e=vt(t,r);return{type:"fillSketch",ops:this.renderLines(e,r)}}renderLines(t,r){let e=[];for(let s of t)e.push(...this.helper.doubleLineOps(s[0][0],s[0][1],s[1][0],s[1][1],r));return e}};function Tt(l){let t=l[0],r=l[1];return Math.sqrt(Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2))}var Xt=class extends kt{fillPolygons(t,r){let e=r.hachureGap;e<0&&(e=4*r.strokeWidth),e=Math.max(e,.1);let s=vt(t,Object.assign({},r,{hachureGap:e})),i=Math.PI/180*r.hachureAngle,o=[],a=.5*e*Math.cos(i),c=.5*e*Math.sin(i);for(let[n,h]of s)Tt([n,h])&&o.push([[n[0]-a,n[1]+c],[...h]],[[n[0]+a,n[1]-c],[...h]]);return{type:"fillSketch",ops:this.renderLines(o,r)}}},Yt=class extends kt{fillPolygons(t,r){let e=this._fillPolygons(t,r),s=Object.assign({},r,{hachureAngle:r.hachureAngle+90}),i=this._fillPolygons(t,s);return e.ops=e.ops.concat(i.ops),e}},Vt=class{constructor(t){this.helper=t}fillPolygons(t,r){let e=vt(t,r=Object.assign({},r,{hachureAngle:0}));return this.dotsOnLines(e,r)}dotsOnLines(t,r){let e=[],s=r.hachureGap;s<0&&(s=4*r.strokeWidth),s=Math.max(s,.1);let i=r.fillWeight;i<0&&(i=r.strokeWidth/2);let o=s/4;for(let a of t){let c=Tt(a),n=c/s,h=Math.ceil(n)-1,p=c-h*s,f=(a[0][0]+a[1][0])/2-s/4,g=Math.min(a[0][1],a[1][1]);for(let u=0;u<h;u++){let y=g+p+u*s,m=f-o+2*Math.random()*o,d=y-o+2*Math.random()*o,x=this.helper.ellipse(m,d,i,i,r);e.push(...x.ops)}}return{type:"fillSketch",ops:e}}},Zt=class{constructor(t){this.helper=t}fillPolygons(t,r){let e=vt(t,r);return{type:"fillSketch",ops:this.dashedLine(e,r)}}dashedLine(t,r){let e=r.dashOffset<0?r.hachureGap<0?4*r.strokeWidth:r.hachureGap:r.dashOffset,s=r.dashGap<0?r.hachureGap<0?4*r.strokeWidth:r.hachureGap:r.dashGap,i=[];return t.forEach(o=>{let a=Tt(o),c=Math.floor(a/(e+s)),n=(a+s-c*(e+s))/2,h=o[0],p=o[1];h[0]>p[0]&&(h=o[1],p=o[0]);let f=Math.atan((p[1]-h[1])/(p[0]-h[0]));for(let g=0;g<c;g++){let u=g*(e+s),y=u+e,m=[h[0]+u*Math.cos(f)+n*Math.cos(f),h[1]+u*Math.sin(f)+n*Math.sin(f)],d=[h[0]+y*Math.cos(f)+n*Math.cos(f),h[1]+y*Math.sin(f)+n*Math.sin(f)];i.push(...this.helper.doubleLineOps(m[0],m[1],d[0],d[1],r))}}),i}},Qt=class{constructor(t){this.helper=t}fillPolygons(t,r){let e=r.hachureGap<0?4*r.strokeWidth:r.hachureGap,s=r.zigzagOffset<0?e:r.zigzagOffset,i=vt(t,r=Object.assign({},r,{hachureGap:e+s}));return{type:"fillSketch",ops:this.zigzagLines(i,s,r)}}zigzagLines(t,r,e){let s=[];return t.forEach(i=>{let o=Tt(i),a=Math.round(o/(2*r)),c=i[0],n=i[1];c[0]>n[0]&&(c=i[1],n=i[0]);let h=Math.atan((n[1]-c[1])/(n[0]-c[0]));for(let p=0;p<a;p++){let f=2*p*r,g=2*(p+1)*r,u=Math.sqrt(2*Math.pow(r,2)),y=[c[0]+f*Math.cos(h),c[1]+f*Math.sin(h)],m=[c[0]+g*Math.cos(h),c[1]+g*Math.sin(h)],d=[y[0]+u*Math.cos(h+Math.PI/4),y[1]+u*Math.sin(h+Math.PI/4)];s.push(...this.helper.doubleLineOps(y[0],y[1],d[0],d[1],e),...this.helper.doubleLineOps(d[0],d[1],m[0],m[1],e))}}),s}},et={},Jt=class{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}},Ve=0,jt=1,ys=2,Dt={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Gt(l,t){return l.type===t}function as(l){let t=[],r=function(o){let a=new Array;for(;o!=="";)if(o.match(/^([ \t\r\n,]+)/))o=o.substr(RegExp.$1.length);else if(o.match(/^([aAcChHlLmMqQsStTvVzZ])/))a[a.length]={type:Ve,text:RegExp.$1},o=o.substr(RegExp.$1.length);else{if(!o.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];a[a.length]={type:jt,text:`${parseFloat(RegExp.$1)}`},o=o.substr(RegExp.$1.length)}return a[a.length]={type:ys,text:""},a}(l),e="BOD",s=0,i=r[s];for(;!Gt(i,ys);){let o=0,a=[];if(e==="BOD"){if(i.text!=="M"&&i.text!=="m")return as("M0,0"+l);s++,o=Dt[i.text],e=i.text}else Gt(i,jt)?o=Dt[e]:(s++,o=Dt[i.text],e=i.text);if(!(s+o<r.length))throw new Error("Path data ended short");for(let c=s;c<s+o;c++){let n=r[c];if(!Gt(n,jt))throw new Error("Param not a number: "+e+","+n.text);a[a.length]=+n.text}if(typeof Dt[e]!="number")throw new Error("Bad segment: "+e);{let c={key:e,data:a};t.push(c),s+=o,i=r[s],e==="M"&&(e="L"),e==="m"&&(e="l")}}return t}function ks(l){let t=0,r=0,e=0,s=0,i=[];for(let{key:o,data:a}of l)switch(o){case"M":i.push({key:"M",data:[...a]}),[t,r]=a,[e,s]=a;break;case"m":t+=a[0],r+=a[1],i.push({key:"M",data:[t,r]}),e=t,s=r;break;case"L":i.push({key:"L",data:[...a]}),[t,r]=a;break;case"l":t+=a[0],r+=a[1],i.push({key:"L",data:[t,r]});break;case"C":i.push({key:"C",data:[...a]}),t=a[4],r=a[5];break;case"c":{let c=a.map((n,h)=>h%2?n+r:n+t);i.push({key:"C",data:c}),t=c[4],r=c[5];break}case"Q":i.push({key:"Q",data:[...a]}),t=a[2],r=a[3];break;case"q":{let c=a.map((n,h)=>h%2?n+r:n+t);i.push({key:"Q",data:c}),t=c[2],r=c[3];break}case"A":i.push({key:"A",data:[...a]}),t=a[5],r=a[6];break;case"a":t+=a[5],r+=a[6],i.push({key:"A",data:[a[0],a[1],a[2],a[3],a[4],t,r]});break;case"H":i.push({key:"H",data:[...a]}),t=a[0];break;case"h":t+=a[0],i.push({key:"H",data:[t]});break;case"V":i.push({key:"V",data:[...a]}),r=a[0];break;case"v":r+=a[0],i.push({key:"V",data:[r]});break;case"S":i.push({key:"S",data:[...a]}),t=a[2],r=a[3];break;case"s":{let c=a.map((n,h)=>h%2?n+r:n+t);i.push({key:"S",data:c}),t=c[2],r=c[3];break}case"T":i.push({key:"T",data:[...a]}),t=a[0],r=a[1];break;case"t":t+=a[0],r+=a[1],i.push({key:"T",data:[t,r]});break;case"Z":case"z":i.push({key:"Z",data:[]}),t=e,r=s}return i}function vs(l){let t=[],r="",e=0,s=0,i=0,o=0,a=0,c=0;for(let{key:n,data:h}of l){switch(n){case"M":t.push({key:"M",data:[...h]}),[e,s]=h,[i,o]=h;break;case"C":t.push({key:"C",data:[...h]}),e=h[4],s=h[5],a=h[2],c=h[3];break;case"L":t.push({key:"L",data:[...h]}),[e,s]=h;break;case"H":e=h[0],t.push({key:"L",data:[e,s]});break;case"V":s=h[0],t.push({key:"L",data:[e,s]});break;case"S":{let p=0,f=0;r==="C"||r==="S"?(p=e+(e-a),f=s+(s-c)):(p=e,f=s),t.push({key:"C",data:[p,f,...h]}),a=h[0],c=h[1],e=h[2],s=h[3];break}case"T":{let[p,f]=h,g=0,u=0;r==="Q"||r==="T"?(g=e+(e-a),u=s+(s-c)):(g=e,u=s);let y=e+2*(g-e)/3,m=s+2*(u-s)/3,d=p+2*(g-p)/3,x=f+2*(u-f)/3;t.push({key:"C",data:[y,m,d,x,p,f]}),a=g,c=u,e=p,s=f;break}case"Q":{let[p,f,g,u]=h,y=e+2*(p-e)/3,m=s+2*(f-s)/3,d=g+2*(p-g)/3,x=u+2*(f-u)/3;t.push({key:"C",data:[y,m,d,x,g,u]}),a=p,c=f,e=g,s=u;break}case"A":{let p=Math.abs(h[0]),f=Math.abs(h[1]),g=h[2],u=h[3],y=h[4],m=h[5],d=h[6];p===0||f===0?(t.push({key:"C",data:[e,s,m,d,m,d]}),e=m,s=d):(e!==m||s!==d)&&($s(e,s,m,d,p,f,g,u,y).forEach(function(x){t.push({key:"C",data:x})}),e=m,s=d);break}case"Z":t.push({key:"Z",data:[]}),e=i,s=o}r=n}return t}function St(l,t,r){return[l*Math.cos(r)-t*Math.sin(r),l*Math.sin(r)+t*Math.cos(r)]}function $s(l,t,r,e,s,i,o,a,c,n){let h=(p=o,Math.PI*p/180);var p;let f=[],g=0,u=0,y=0,m=0;if(n)[g,u,y,m]=n;else{[l,t]=St(l,t,-h),[r,e]=St(r,e,-h);let X=(l-r)/2,A=(t-e)/2,I=X*X/(s*s)+A*A/(i*i);I>1&&(I=Math.sqrt(I),s*=I,i*=I);let N=s*s,G=i*i,O=N*G-N*A*A-G*X*X,T=N*A*A+G*X*X,z=(a===c?-1:1)*Math.sqrt(Math.abs(O/T));y=z*s*A/i+(l+r)/2,m=z*-i*X/s+(t+e)/2,g=Math.asin(parseFloat(((t-m)/i).toFixed(9))),u=Math.asin(parseFloat(((e-m)/i).toFixed(9))),l<y&&(g=Math.PI-g),r<y&&(u=Math.PI-u),g<0&&(g=2*Math.PI+g),u<0&&(u=2*Math.PI+u),c&&g>u&&(g-=2*Math.PI),!c&&u>g&&(u-=2*Math.PI)}let d=u-g;if(Math.abs(d)>120*Math.PI/180){let X=u,A=r,I=e;u=c&&u>g?g+120*Math.PI/180*1:g+120*Math.PI/180*-1,f=$s(r=y+s*Math.cos(u),e=m+i*Math.sin(u),A,I,s,i,o,0,c,[u,X,y,m])}d=u-g;let x=Math.cos(g),S=Math.sin(g),b=Math.cos(u),v=Math.sin(u),k=Math.tan(d/4),D=4/3*s*k,$=4/3*i*k,P=[l,t],B=[l+D*S,t-$*x],F=[r+D*v,e-$*b],V=[r,e];if(B[0]=2*P[0]-B[0],B[1]=2*P[1]-B[1],n)return[B,F,V].concat(f);{f=[B,F,V].concat(f);let X=[];for(let A=0;A<f.length;A+=3){let I=St(f[A][0],f[A][1],h),N=St(f[A+1][0],f[A+1][1],h),G=St(f[A+2][0],f[A+2][1],h);X.push([I[0],I[1],N[0],N[1],G[0],G[1]])}return X}}var Ze={randOffset:function(l,t){return E(l,t)},randOffsetWithRange:function(l,t,r){return Rt(l,t,r)},ellipse:function(l,t,r,e,s){let i=Ps(r,e,s);return Ut(l,t,s,i).opset},doubleLineOps:function(l,t,r,e,s){return ht(l,t,r,e,s,!0)}};function Ds(l,t,r,e,s){return{type:"path",ops:ht(l,t,r,e,s)}}function Bt(l,t,r){let e=(l||[]).length;if(e>2){let s=[];for(let i=0;i<e-1;i++)s.push(...ht(l[i][0],l[i][1],l[i+1][0],l[i+1][1],r));return t&&s.push(...ht(l[e-1][0],l[e-1][1],l[0][0],l[0][1],r)),{type:"path",ops:s}}return e===2?Ds(l[0][0],l[0][1],l[1][0],l[1][1],r):{type:"path",ops:[]}}function Qe(l,t,r,e,s){return function(i,o){return Bt(i,!0,o)}([[l,t],[l+r,t],[l+r,t+e],[l,t+e]],s)}function ds(l,t){if(l.length){let r=typeof l[0][0]=="number"?[l]:l,e=Pt(r[0],1*(1+.2*t.roughness),t),s=t.disableMultiStroke?[]:Pt(r[0],1.5*(1+.22*t.roughness),bs(t));for(let i=1;i<r.length;i++){let o=r[i];if(o.length){let a=Pt(o,1*(1+.2*t.roughness),t),c=t.disableMultiStroke?[]:Pt(o,1.5*(1+.22*t.roughness),bs(t));for(let n of a)n.op!=="move"&&e.push(n);for(let n of c)n.op!=="move"&&s.push(n)}}return{type:"path",ops:e.concat(s)}}return{type:"path",ops:[]}}function Ps(l,t,r){let e=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(l/2,2)+Math.pow(t/2,2))/2)),s=Math.ceil(Math.max(r.curveStepCount,r.curveStepCount/Math.sqrt(200)*e)),i=2*Math.PI/s,o=Math.abs(l/2),a=Math.abs(t/2),c=1-r.curveFitting;return o+=E(o*c,r),a+=E(a*c,r),{increment:i,rx:o,ry:a}}function Ut(l,t,r,e){let[s,i]=ws(e.increment,l,t,e.rx,e.ry,1,e.increment*Rt(.1,Rt(.4,1,r),r),r),o=Lt(s,null,r);if(!r.disableMultiStroke&&r.roughness!==0){let[a]=ws(e.increment,l,t,e.rx,e.ry,1.5,0,r),c=Lt(a,null,r);o=o.concat(c)}return{estimatedPoints:i,opset:{type:"path",ops:o}}}function ms(l,t,r,e,s,i,o,a,c){let n=l,h=t,p=Math.abs(r/2),f=Math.abs(e/2);p+=E(.01*p,c),f+=E(.01*f,c);let g=s,u=i;for(;g<0;)g+=2*Math.PI,u+=2*Math.PI;u-g>2*Math.PI&&(g=0,u=2*Math.PI);let y=2*Math.PI/c.curveStepCount,m=Math.min(y/2,(u-g)/2),d=Ss(m,n,h,p,f,g,u,1,c);if(!c.disableMultiStroke){let x=Ss(m,n,h,p,f,g,u,1.5,c);d.push(...x)}return o&&(a?d.push(...ht(n,h,n+p*Math.cos(g),h+f*Math.sin(g),c),...ht(n,h,n+p*Math.cos(u),h+f*Math.sin(u),c)):d.push({op:"lineTo",data:[n,h]},{op:"lineTo",data:[n+p*Math.cos(g),h+f*Math.sin(g)]})),{type:"path",ops:d}}function xs(l,t){let r=vs(ks(as(l))),e=[],s=[0,0],i=[0,0];for(let{key:o,data:a}of r)switch(o){case"M":i=[a[0],a[1]],s=[a[0],a[1]];break;case"L":e.push(...ht(i[0],i[1],a[0],a[1],t)),i=[a[0],a[1]];break;case"C":{let[c,n,h,p,f,g]=a;e.push(...Je(c,n,h,p,f,g,i,t)),i=[f,g];break}case"Z":e.push(...ht(i[0],i[1],s[0],s[1],t)),i=[s[0],s[1]]}return{type:"path",ops:e}}function Ft(l,t){let r=[];for(let e of l)if(e.length){let s=t.maxRandomnessOffset||0,i=e.length;if(i>2){r.push({op:"move",data:[e[0][0]+E(s,t),e[0][1]+E(s,t)]});for(let o=1;o<i;o++)r.push({op:"lineTo",data:[e[o][0]+E(s,t),e[o][1]+E(s,t)]})}}return{type:"fillPath",ops:r}}function yt(l,t){return function(r,e){let s=r.fillStyle||"hachure";if(!et[s])switch(s){case"zigzag":et[s]||(et[s]=new Xt(e));break;case"cross-hatch":et[s]||(et[s]=new Yt(e));break;case"dots":et[s]||(et[s]=new Vt(e));break;case"dashed":et[s]||(et[s]=new Zt(e));break;case"zigzag-line":et[s]||(et[s]=new Qt(e));break;default:s="hachure",et[s]||(et[s]=new kt(e))}return et[s]}(t,Ze).fillPolygons(l,t)}function bs(l){let t=Object.assign({},l);return t.randomizer=void 0,l.seed&&(t.seed=l.seed+1),t}function Cs(l){return l.randomizer||(l.randomizer=new Jt(l.seed||0)),l.randomizer.next()}function Rt(l,t,r,e=1){return r.roughness*e*(Cs(r)*(t-l)+l)}function E(l,t,r=1){return Rt(-l,l,t,r)}function ht(l,t,r,e,s,i=!1){let o=i?s.disableMultiStrokeFill:s.disableMultiStroke,a=Kt(l,t,r,e,s,!0,!1);if(o)return a;let c=Kt(l,t,r,e,s,!0,!0);return a.concat(c)}function Kt(l,t,r,e,s,i,o){let a=Math.pow(l-r,2)+Math.pow(t-e,2),c=Math.sqrt(a),n=1;n=c<200?1:c>500?.4:-.0016668*c+1.233334;let h=s.maxRandomnessOffset||0;h*h*100>a&&(h=c/10);let p=h/2,f=.2+.2*Cs(s),g=s.bowing*s.maxRandomnessOffset*(e-t)/200,u=s.bowing*s.maxRandomnessOffset*(l-r)/200;g=E(g,s,n),u=E(u,s,n);let y=[],m=()=>E(p,s,n),d=()=>E(h,s,n),x=s.preserveVertices;return i&&(o?y.push({op:"move",data:[l+(x?0:m()),t+(x?0:m())]}):y.push({op:"move",data:[l+(x?0:E(h,s,n)),t+(x?0:E(h,s,n))]})),o?y.push({op:"bcurveTo",data:[g+l+(r-l)*f+m(),u+t+(e-t)*f+m(),g+l+2*(r-l)*f+m(),u+t+2*(e-t)*f+m(),r+(x?0:m()),e+(x?0:m())]}):y.push({op:"bcurveTo",data:[g+l+(r-l)*f+d(),u+t+(e-t)*f+d(),g+l+2*(r-l)*f+d(),u+t+2*(e-t)*f+d(),r+(x?0:d()),e+(x?0:d())]}),y}function Pt(l,t,r){if(!l.length)return[];let e=[];e.push([l[0][0]+E(t,r),l[0][1]+E(t,r)]),e.push([l[0][0]+E(t,r),l[0][1]+E(t,r)]);for(let s=1;s<l.length;s++)e.push([l[s][0]+E(t,r),l[s][1]+E(t,r)]),s===l.length-1&&e.push([l[s][0]+E(t,r),l[s][1]+E(t,r)]);return Lt(e,null,r)}function Lt(l,t,r){let e=l.length,s=[];if(e>3){let i=[],o=1-r.curveTightness;s.push({op:"move",data:[l[1][0],l[1][1]]});for(let a=1;a+2<e;a++){let c=l[a];i[0]=[c[0],c[1]],i[1]=[c[0]+(o*l[a+1][0]-o*l[a-1][0])/6,c[1]+(o*l[a+1][1]-o*l[a-1][1])/6],i[2]=[l[a+1][0]+(o*l[a][0]-o*l[a+2][0])/6,l[a+1][1]+(o*l[a][1]-o*l[a+2][1])/6],i[3]=[l[a+1][0],l[a+1][1]],s.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1]]})}if(t&&t.length===2){let a=r.maxRandomnessOffset;s.push({op:"lineTo",data:[t[0]+E(a,r),t[1]+E(a,r)]})}}else e===3?(s.push({op:"move",data:[l[1][0],l[1][1]]}),s.push({op:"bcurveTo",data:[l[1][0],l[1][1],l[2][0],l[2][1],l[2][0],l[2][1]]})):e===2&&s.push(...Kt(l[0][0],l[0][1],l[1][0],l[1][1],r,!0,!0));return s}function ws(l,t,r,e,s,i,o,a){let c=[],n=[];if(a.roughness===0){l/=4,n.push([t+e*Math.cos(-l),r+s*Math.sin(-l)]);for(let h=0;h<=2*Math.PI;h+=l){let p=[t+e*Math.cos(h),r+s*Math.sin(h)];c.push(p),n.push(p)}n.push([t+e*Math.cos(0),r+s*Math.sin(0)]),n.push([t+e*Math.cos(l),r+s*Math.sin(l)])}else{let h=E(.5,a)-Math.PI/2;n.push([E(i,a)+t+.9*e*Math.cos(h-l),E(i,a)+r+.9*s*Math.sin(h-l)]);let p=2*Math.PI+h-.01;for(let f=h;f<p;f+=l){let g=[E(i,a)+t+e*Math.cos(f),E(i,a)+r+s*Math.sin(f)];c.push(g),n.push(g)}n.push([E(i,a)+t+e*Math.cos(h+2*Math.PI+.5*o),E(i,a)+r+s*Math.sin(h+2*Math.PI+.5*o)]),n.push([E(i,a)+t+.98*e*Math.cos(h+o),E(i,a)+r+.98*s*Math.sin(h+o)]),n.push([E(i,a)+t+.9*e*Math.cos(h+.5*o),E(i,a)+r+.9*s*Math.sin(h+.5*o)])}return[n,c]}function Ss(l,t,r,e,s,i,o,a,c){let n=i+E(.1,c),h=[];h.push([E(a,c)+t+.9*e*Math.cos(n-l),E(a,c)+r+.9*s*Math.sin(n-l)]);for(let p=n;p<=o;p+=l)h.push([E(a,c)+t+e*Math.cos(p),E(a,c)+r+s*Math.sin(p)]);return h.push([t+e*Math.cos(o),r+s*Math.sin(o)]),h.push([t+e*Math.cos(o),r+s*Math.sin(o)]),Lt(h,null,c)}function Je(l,t,r,e,s,i,o,a){let c=[],n=[a.maxRandomnessOffset||1,(a.maxRandomnessOffset||1)+.3],h=[0,0],p=a.disableMultiStroke?1:2,f=a.preserveVertices;for(let g=0;g<p;g++)g===0?c.push({op:"move",data:[o[0],o[1]]}):c.push({op:"move",data:[o[0]+(f?0:E(n[0],a)),o[1]+(f?0:E(n[0],a))]}),h=f?[s,i]:[s+E(n[g],a),i+E(n[g],a)],c.push({op:"bcurveTo",data:[l+E(n[g],a),t+E(n[g],a),r+E(n[g],a),e+E(n[g],a),h[0],h[1]]});return c}function Mt(l){return[...l]}function Ms(l,t=0){let r=l.length;if(r<3)throw new Error("A curve must have at least three points.");let e=[];if(r===3)e.push(Mt(l[0]),Mt(l[1]),Mt(l[2]),Mt(l[2]));else{let s=[];s.push(l[0],l[0]);for(let a=1;a<l.length;a++)s.push(l[a]),a===l.length-1&&s.push(l[a]);let i=[],o=1-t;e.push(Mt(s[0]));for(let a=1;a+2<s.length;a++){let c=s[a];i[0]=[c[0],c[1]],i[1]=[c[0]+(o*s[a+1][0]-o*s[a-1][0])/6,c[1]+(o*s[a+1][1]-o*s[a-1][1])/6],i[2]=[s[a+1][0]+(o*s[a][0]-o*s[a+2][0])/6,s[a+1][1]+(o*s[a][1]-o*s[a+2][1])/6],i[3]=[s[a+1][0],s[a+1][1]],e.push(i[1],i[2],i[3])}}return e}function Nt(l,t){return Math.pow(l[0]-t[0],2)+Math.pow(l[1]-t[1],2)}function Ue(l,t,r){let e=Nt(t,r);if(e===0)return Nt(l,t);let s=((l[0]-t[0])*(r[0]-t[0])+(l[1]-t[1])*(r[1]-t[1]))/e;return s=Math.max(0,Math.min(1,s)),Nt(l,ft(t,r,s))}function ft(l,t,r){return[l[0]+(t[0]-l[0])*r,l[1]+(t[1]-l[1])*r]}function ts(l,t,r,e){let s=e||[];if(function(a,c){let n=a[c+0],h=a[c+1],p=a[c+2],f=a[c+3],g=3*h[0]-2*n[0]-f[0];g*=g;let u=3*h[1]-2*n[1]-f[1];u*=u;let y=3*p[0]-2*f[0]-n[0];y*=y;let m=3*p[1]-2*f[1]-n[1];return m*=m,g<y&&(g=y),u<m&&(u=m),g+u}(l,t)<r){let a=l[t+0];s.length?(i=s[s.length-1],o=a,Math.sqrt(Nt(i,o))>1&&s.push(a)):s.push(a),s.push(l[t+3])}else{let c=l[t+0],n=l[t+1],h=l[t+2],p=l[t+3],f=ft(c,n,.5),g=ft(n,h,.5),u=ft(h,p,.5),y=ft(f,g,.5),m=ft(g,u,.5),d=ft(y,m,.5);ts([c,f,y,d],0,r,s),ts([d,m,u,p],0,r,s)}var i,o;return s}function Ke(l,t){return At(l,0,l.length,t)}function At(l,t,r,e,s){let i=s||[],o=l[t],a=l[r-1],c=0,n=1;for(let h=t+1;h<r-1;++h){let p=Ue(l[h],o,a);p>c&&(c=p,n=h)}return Math.sqrt(c)>e?(At(l,t,n+1,e,i),At(l,n,r,e,i)):(i.length||i.push(o),i.push(a)),i}function qt(l,t=.15,r){let e=[],s=(l.length-1)/3;for(let i=0;i<s;i++)ts(l,3*i,t,e);return r&&r>0?At(e,0,e.length,r):e}var at="none",dt=class{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,r,e){return{shape:t,sets:r||[],options:e||this.defaultOptions}}line(t,r,e,s,i){let o=this._o(i);return this._d("line",[Ds(t,r,e,s,o)],o)}rectangle(t,r,e,s,i){let o=this._o(i),a=[],c=Qe(t,r,e,s,o);if(o.fill){let n=[[t,r],[t+e,r],[t+e,r+s],[t,r+s]];o.fillStyle==="solid"?a.push(Ft([n],o)):a.push(yt([n],o))}return o.stroke!==at&&a.push(c),this._d("rectangle",a,o)}ellipse(t,r,e,s,i){let o=this._o(i),a=[],c=Ps(e,s,o),n=Ut(t,r,o,c);if(o.fill)if(o.fillStyle==="solid"){let h=Ut(t,r,o,c).opset;h.type="fillPath",a.push(h)}else a.push(yt([n.estimatedPoints],o));return o.stroke!==at&&a.push(n.opset),this._d("ellipse",a,o)}circle(t,r,e,s){let i=this.ellipse(t,r,e,e,s);return i.shape="circle",i}linearPath(t,r){let e=this._o(r);return this._d("linearPath",[Bt(t,!1,e)],e)}arc(t,r,e,s,i,o,a=!1,c){let n=this._o(c),h=[],p=ms(t,r,e,s,i,o,a,!0,n);if(a&&n.fill)if(n.fillStyle==="solid"){let f=Object.assign({},n);f.disableMultiStroke=!0;let g=ms(t,r,e,s,i,o,!0,!1,f);g.type="fillPath",h.push(g)}else h.push(function(f,g,u,y,m,d,x){let S=f,b=g,v=Math.abs(u/2),k=Math.abs(y/2);v+=E(.01*v,x),k+=E(.01*k,x);let D=m,$=d;for(;D<0;)D+=2*Math.PI,$+=2*Math.PI;$-D>2*Math.PI&&(D=0,$=2*Math.PI);let P=($-D)/x.curveStepCount,B=[];for(let F=D;F<=$;F+=P)B.push([S+v*Math.cos(F),b+k*Math.sin(F)]);return B.push([S+v*Math.cos($),b+k*Math.sin($)]),B.push([S,b]),yt([B],x)}(t,r,e,s,i,o,n));return n.stroke!==at&&h.push(p),this._d("arc",h,n)}curve(t,r){let e=this._o(r),s=[],i=ds(t,e);if(e.fill&&e.fill!==at)if(e.fillStyle==="solid"){let o=ds(t,Object.assign(Object.assign({},e),{disableMultiStroke:!0,roughness:e.roughness?e.roughness+e.fillShapeRoughnessGain:0}));s.push({type:"fillPath",ops:this._mergedShape(o.ops)})}else{let o=[],a=t;if(a.length){let c=typeof a[0][0]=="number"?[a]:a;for(let n of c)n.length<3?o.push(...n):n.length===3?o.push(...qt(Ms([n[0],n[0],n[1],n[2]]),10,(1+e.roughness)/2)):o.push(...qt(Ms(n),10,(1+e.roughness)/2))}o.length&&s.push(yt([o],e))}return e.stroke!==at&&s.push(i),this._d("curve",s,e)}polygon(t,r){let e=this._o(r),s=[],i=Bt(t,!0,e);return e.fill&&(e.fillStyle==="solid"?s.push(Ft([t],e)):s.push(yt([t],e))),e.stroke!==at&&s.push(i),this._d("polygon",s,e)}path(t,r){let e=this._o(r),s=[];if(!t)return this._d("path",s,e);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");let i=e.fill&&e.fill!=="transparent"&&e.fill!==at,o=e.stroke!==at,a=!!(e.simplification&&e.simplification<1),c=function(h,p,f){let g=vs(ks(as(h))),u=[],y=[],m=[0,0],d=[],x=()=>{d.length>=4&&y.push(...qt(d,p)),d=[]},S=()=>{x(),y.length&&(u.push(y),y=[])};for(let{key:v,data:k}of g)switch(v){case"M":S(),m=[k[0],k[1]],y.push(m);break;case"L":x(),y.push([k[0],k[1]]);break;case"C":if(!d.length){let D=y.length?y[y.length-1]:m;d.push([D[0],D[1]])}d.push([k[0],k[1]]),d.push([k[2],k[3]]),d.push([k[4],k[5]]);break;case"Z":x(),y.push([m[0],m[1]])}if(S(),!f)return u;let b=[];for(let v of u){let k=Ke(v,f);k.length&&b.push(k)}return b}(t,1,a?4-4*(e.simplification||1):(1+e.roughness)/2),n=xs(t,e);if(i)if(e.fillStyle==="solid")if(c.length===1){let h=xs(t,Object.assign(Object.assign({},e),{disableMultiStroke:!0,roughness:e.roughness?e.roughness+e.fillShapeRoughnessGain:0}));s.push({type:"fillPath",ops:this._mergedShape(h.ops)})}else s.push(Ft(c,e));else s.push(yt(c,e));return o&&(a?c.forEach(h=>{s.push(Bt(h,!1,e))}):s.push(n)),this._d("path",s,e)}opsToPath(t,r){let e="";for(let s of t.ops){let i=typeof r=="number"&&r>=0?s.data.map(o=>+o.toFixed(r)):s.data;switch(s.op){case"move":e+=`M${i[0]} ${i[1]} `;break;case"bcurveTo":e+=`C${i[0]} ${i[1]}, ${i[2]} ${i[3]}, ${i[4]} ${i[5]} `;break;case"lineTo":e+=`L${i[0]} ${i[1]} `}}return e.trim()}toPaths(t){let r=t.sets||[],e=t.options||this.defaultOptions,s=[];for(let i of r){let o=null;switch(i.type){case"path":o={d:this.opsToPath(i),stroke:e.stroke,strokeWidth:e.strokeWidth,fill:at};break;case"fillPath":o={d:this.opsToPath(i),stroke:at,strokeWidth:0,fill:e.fill||at};break;case"fillSketch":o=this.fillSketch(i,e)}o&&s.push(o)}return s}fillSketch(t,r){let e=r.fillWeight;return e<0&&(e=r.strokeWidth/2),{d:this.opsToPath(t),stroke:r.fill||at,strokeWidth:e,fill:at}}_mergedShape(t){return t.filter((r,e)=>e===0||r.op!=="move")}},ss=class{constructor(t,r){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new dt(r)}draw(t){let r=t.sets||[],e=t.options||this.getDefaultOptions(),s=this.ctx,i=t.options.fixedDecimalPlaceDigits;for(let o of r)switch(o.type){case"path":s.save(),s.strokeStyle=e.stroke==="none"?"transparent":e.stroke,s.lineWidth=e.strokeWidth,e.strokeLineDash&&s.setLineDash(e.strokeLineDash),e.strokeLineDashOffset&&(s.lineDashOffset=e.strokeLineDashOffset),this._drawToContext(s,o,i),s.restore();break;case"fillPath":{s.save(),s.fillStyle=e.fill||"";let a=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(s,o,i,a),s.restore();break}case"fillSketch":this.fillSketch(s,o,e)}}fillSketch(t,r,e){let s=e.fillWeight;s<0&&(s=e.strokeWidth/2),t.save(),e.fillLineDash&&t.setLineDash(e.fillLineDash),e.fillLineDashOffset&&(t.lineDashOffset=e.fillLineDashOffset),t.strokeStyle=e.fill||"",t.lineWidth=s,this._drawToContext(t,r,e.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,r,e,s="nonzero"){t.beginPath();for(let i of r.ops){let o=typeof e=="number"&&e>=0?i.data.map(a=>+a.toFixed(e)):i.data;switch(i.op){case"move":t.moveTo(o[0],o[1]);break;case"bcurveTo":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"lineTo":t.lineTo(o[0],o[1])}}r.type==="fillPath"?t.fill(s):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,r,e,s,i){let o=this.gen.line(t,r,e,s,i);return this.draw(o),o}rectangle(t,r,e,s,i){let o=this.gen.rectangle(t,r,e,s,i);return this.draw(o),o}ellipse(t,r,e,s,i){let o=this.gen.ellipse(t,r,e,s,i);return this.draw(o),o}circle(t,r,e,s){let i=this.gen.circle(t,r,e,s);return this.draw(i),i}linearPath(t,r){let e=this.gen.linearPath(t,r);return this.draw(e),e}polygon(t,r){let e=this.gen.polygon(t,r);return this.draw(e),e}arc(t,r,e,s,i,o,a=!1,c){let n=this.gen.arc(t,r,e,s,i,o,a,c);return this.draw(n),n}curve(t,r){let e=this.gen.curve(t,r);return this.draw(e),e}path(t,r){let e=this.gen.path(t,r);return this.draw(e),e}},Ct="http://www.w3.org/2000/svg",es=class{constructor(t,r){this.svg=t,this.gen=new dt(r)}draw(t){let r=t.sets||[],e=t.options||this.getDefaultOptions(),s=this.svg.ownerDocument||window.document,i=s.createElementNS(Ct,"g"),o=t.options.fixedDecimalPlaceDigits;for(let a of r){let c=null;switch(a.type){case"path":c=s.createElementNS(Ct,"path"),c.setAttribute("d",this.opsToPath(a,o)),c.setAttribute("stroke",e.stroke),c.setAttribute("stroke-width",e.strokeWidth+""),c.setAttribute("fill","none"),e.strokeLineDash&&c.setAttribute("stroke-dasharray",e.strokeLineDash.join(" ").trim()),e.strokeLineDashOffset&&c.setAttribute("stroke-dashoffset",`${e.strokeLineDashOffset}`);break;case"fillPath":c=s.createElementNS(Ct,"path"),c.setAttribute("d",this.opsToPath(a,o)),c.setAttribute("stroke","none"),c.setAttribute("stroke-width","0"),c.setAttribute("fill",e.fill||""),t.shape!=="curve"&&t.shape!=="polygon"||c.setAttribute("fill-rule","evenodd");break;case"fillSketch":c=this.fillSketch(s,a,e)}c&&i.appendChild(c)}return i}fillSketch(t,r,e){let s=e.fillWeight;s<0&&(s=e.strokeWidth/2);let i=t.createElementNS(Ct,"path");return i.setAttribute("d",this.opsToPath(r,e.fixedDecimalPlaceDigits)),i.setAttribute("stroke",e.fill||""),i.setAttribute("stroke-width",s+""),i.setAttribute("fill","none"),e.fillLineDash&&i.setAttribute("stroke-dasharray",e.fillLineDash.join(" ").trim()),e.fillLineDashOffset&&i.setAttribute("stroke-dashoffset",`${e.fillLineDashOffset}`),i}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,r){return this.gen.opsToPath(t,r)}line(t,r,e,s,i){let o=this.gen.line(t,r,e,s,i);return this.draw(o)}rectangle(t,r,e,s,i){let o=this.gen.rectangle(t,r,e,s,i);return this.draw(o)}ellipse(t,r,e,s,i){let o=this.gen.ellipse(t,r,e,s,i);return this.draw(o)}circle(t,r,e,s){let i=this.gen.circle(t,r,e,s);return this.draw(i)}linearPath(t,r){let e=this.gen.linearPath(t,r);return this.draw(e)}polygon(t,r){let e=this.gen.polygon(t,r);return this.draw(e)}arc(t,r,e,s,i,o,a=!1,c){let n=this.gen.arc(t,r,e,s,i,o,a,c);return this.draw(n)}curve(t,r){let e=this.gen.curve(t,r);return this.draw(e)}path(t,r){let e=this.gen.path(t,r);return this.draw(e)}},M={canvas:(l,t)=>new ss(l,t),svg:(l,t)=>new es(l,t),generator:l=>new dt(l),newSeed:()=>dt.newSeed()};var j=w((l,t,r)=>C(void 0,null,function*(){let e,s=t.useHtmlLabels||K(Q()?.htmlLabels);r?e=r:e="node default";let i=l.insert("g").attr("class",e).attr("id",t.domId||t.id),o=i.insert("g").attr("class","label").attr("style",tt(t.labelStyle)),a;t.label===void 0?a="":a=typeof t.label=="string"?t.label:t.label[0];let c=yield ut(o,Et(wt(a),Q()),{useHtmlLabels:s,width:t.width||Q().flowchart?.wrappingWidth,cssClasses:"markdown-node-label",style:t.labelStyle,addSvgBackground:!!t.icon||!!t.img}),n=c.getBBox(),h=(t?.padding??0)/2;if(s){let p=c.children[0],f=J(c),g=p.getElementsByTagName("img");if(g){let u=a.replace(/<img[^>]*>/g,"").trim()==="";yield Promise.all([...g].map(y=>new Promise(m=>{function d(){if(y.style.display="flex",y.style.flexDirection="column",u){let x=Q().fontSize?Q().fontSize:window.getComputedStyle(document.body).fontSize,S=5,[b=os.fontSize]=us(x),v=b*S+"px";y.style.minWidth=v,y.style.maxWidth=v}else y.style.width="100%";m(y)}w(d,"setupImage"),setTimeout(()=>{y.complete&&d()}),y.addEventListener("error",d),y.addEventListener("load",d)})))}n=p.getBoundingClientRect(),f.attr("width",n.width),f.attr("height",n.height)}return s?o.attr("transform","translate("+-n.width/2+", "+-n.height/2+")"):o.attr("transform","translate(0, "+-n.height/2+")"),t.centerLabel&&o.attr("transform","translate("+-n.width/2+", "+-n.height/2+")"),o.insert("rect",":first-child"),{shapeSvg:i,bbox:n,halfPadding:h,label:o}}),"labelHelper"),rs=w((l,t,r)=>C(void 0,null,function*(){let e=r.useHtmlLabels||K(Q()?.flowchart?.htmlLabels),s=l.insert("g").attr("class","label").attr("style",r.labelStyle||""),i=yield ut(s,Et(wt(t),Q()),{useHtmlLabels:e,width:r.width||Q()?.flowchart?.wrappingWidth,style:r.labelStyle,addSvgBackground:!!r.icon||!!r.img}),o=i.getBBox(),a=r.padding/2;if(K(Q()?.flowchart?.htmlLabels)){let c=i.children[0],n=J(i);o=c.getBoundingClientRect(),n.attr("width",o.width),n.attr("height",o.height)}return e?s.attr("transform","translate("+-o.width/2+", "+-o.height/2+")"):s.attr("transform","translate(0, "+-o.height/2+")"),r.centerLabel&&s.attr("transform","translate("+-o.width/2+", "+-o.height/2+")"),s.insert("rect",":first-child"),{shapeSvg:l,bbox:o,halfPadding:a,label:s}}),"insertLabel"),W=w((l,t)=>{let r=t.node().getBBox();l.width=r.width,l.height=r.height},"updateNodeBounds"),_=w((l,t)=>(l.look==="handDrawn"?"rough-node":"node")+" "+l.cssClasses+" "+(t||""),"getNodeClasses");function Y(l){let t=l.map((r,e)=>`${e===0?"M":"L"}${r.x},${r.y}`);return t.push("Z"),t.join(" ")}w(Y,"createPathFromPoints");function gt(l,t,r,e,s,i){let o=[],c=r-l,n=e-t,h=c/i,p=2*Math.PI/h,f=t+n/2;for(let g=0;g<=50;g++){let u=g/50,y=l+u*c,m=f+s*Math.sin(p*(y-l));o.push({x:y,y:m})}return o}w(gt,"generateFullSineWavePoints");function cs(l,t,r,e,s,i){let o=[],a=s*Math.PI/180,h=(i*Math.PI/180-a)/(e-1);for(let p=0;p<e;p++){let f=a+p*h,g=l+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:-g,y:-u})}return o}w(cs,"generateCirclePoints");var ta=w((l,t)=>{var r=l.x,e=l.y,s=t.x-r,i=t.y-e,o=l.width/2,a=l.height/2,c,n;return Math.abs(i)*o>Math.abs(s)*a?(i<0&&(a=-a),c=i===0?0:a*s/i,n=a):(s<0&&(o=-o),c=o,n=s===0?0:o*i/s),{x:r+c,y:e+n}},"intersectRect"),mt=ta;function Bs(l,t){t&&l.attr("style",t)}w(Bs,"applyStyle");function Ns(l){return C(this,null,function*(){let t=J(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")),r=t.append("xhtml:div"),e=l.label;l.label&&Ot(l.label)&&(e=yield hs(l.label.replace(gs.lineBreakRegex,`
`),Q()));let s=l.isNode?"nodeLabel":"edgeLabel";return r.html('<span class="'+s+'" '+(l.labelStyle?'style="'+l.labelStyle+'"':"")+">"+e+"</span>"),Bs(r,l.labelStyle),r.style("display","inline-block"),r.style("padding-right","1px"),r.style("white-space","nowrap"),r.attr("xmlns","http://www.w3.org/1999/xhtml"),t.node()})}w(Ns,"addHtmlLabel");var sa=w((l,t,r,e)=>C(void 0,null,function*(){let s=l||"";if(typeof s=="object"&&(s=s[0]),K(Q().flowchart.htmlLabels)){s=s.replace(/\\n|\n/g,"<br />"),Z.info("vertexText"+s);let i={isNode:e,label:wt(s).replace(/fa[blrs]?:fa-[\w-]+/g,a=>`<i class='${a.replace(":"," ")}'></i>`),labelStyle:t&&t.replace("fill:","color:")};return yield Ns(i)}else{let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("style",t.replace("color:","fill:"));let o=[];typeof s=="string"?o=s.split(/\\n|\n|<br\s*\/?>/gi):Array.isArray(s)?o=s:o=[];for(let a of o){let c=document.createElementNS("http://www.w3.org/2000/svg","tspan");c.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),c.setAttribute("dy","1em"),c.setAttribute("x","0"),r?c.setAttribute("class","title-row"):c.setAttribute("class","row"),c.textContent=a.trim(),i.appendChild(c)}return i}}),"createLabel"),is=sa,ct=w((l,t,r,e,s)=>["M",l+s,t,"H",l+r-s,"A",s,s,0,0,1,l+r,t+s,"V",t+e-s,"A",s,s,0,0,1,l+r-s,t+e,"H",l+s,"A",s,s,0,0,1,l,t+e-s,"V",t+s,"A",s,s,0,0,1,l+s,t,"Z"].join(" "),"createRoundedRectPathD"),ea=w(l=>{let{handDrawnSeed:t}=Q();return{fill:l,hachureAngle:120,hachureGap:4,fillWeight:2,roughness:.7,stroke:l,seed:t}},"solidStateFill"),xt=w(l=>{let t=aa([...l.cssCompiledStyles||[],...l.cssStyles||[]]);return{stylesMap:t,stylesArray:[...t]}},"compileStyles"),aa=w(l=>{let t=new Map;return l.forEach(r=>{let[e,s]=r.split(":");t.set(e.trim(),s?.trim())}),t},"styles2Map"),H=w(l=>{let{stylesArray:t}=xt(l),r=[],e=[],s=[],i=[];return t.forEach(o=>{let a=o[0];a==="color"||a==="font-size"||a==="font-family"||a==="font-weight"||a==="font-style"||a==="text-decoration"||a==="text-align"||a==="text-transform"||a==="line-height"||a==="letter-spacing"||a==="word-spacing"||a==="text-shadow"||a==="text-overflow"||a==="white-space"||a==="word-wrap"||a==="word-break"||a==="overflow-wrap"||a==="hyphens"?r.push(o.join(":")+" !important"):(e.push(o.join(":")+" !important"),a.includes("stroke")&&s.push(o.join(":")+" !important"),a==="fill"&&i.push(o.join(":")+" !important"))}),{labelStyles:r.join(";"),nodeStyles:e.join(";"),stylesArray:t,borderStyles:s,backgroundStyles:i}},"styles2String"),L=w((l,t)=>{let{themeVariables:r,handDrawnSeed:e}=Q(),{nodeBorder:s,mainBkg:i}=r,{stylesMap:o}=xt(l);return Object.assign({roughness:.7,fill:o.get("fill")||i,fillStyle:"hachure",fillWeight:4,hachureGap:5.2,stroke:o.get("stroke")||s,seed:e,strokeWidth:o.get("stroke-width")?.replace("px","")||1.3,fillLineDash:[0,0]},t)},"userNodeOverrides"),Rs=w((l,t)=>C(void 0,null,function*(){Z.info("Creating subgraph rect for ",t.id,t);let r=Q(),{themeVariables:e,handDrawnSeed:s}=r,{clusterBkg:i,clusterBorder:o}=e,{labelStyles:a,nodeStyles:c,borderStyles:n,backgroundStyles:h}=H(t),p=l.insert("g").attr("class","cluster "+t.cssClasses).attr("id",t.id).attr("data-look",t.look),f=K(r.flowchart.htmlLabels),g=p.insert("g").attr("class","cluster-label "),u=yield ut(g,t.label,{style:t.labelStyle,useHtmlLabels:f,isNode:!0}),y=u.getBBox();if(K(r.flowchart.htmlLabels)){let D=u.children[0],$=J(u);y=D.getBoundingClientRect(),$.attr("width",y.width),$.attr("height",y.height)}let m=t.width<=y.width+t.padding?y.width+t.padding:t.width;t.width<=y.width+t.padding?t.diff=(m-t.width)/2-t.padding:t.diff=-t.padding;let d=t.height,x=t.x-m/2,S=t.y-d/2;Z.trace("Data ",t,JSON.stringify(t));let b;if(t.look==="handDrawn"){let D=M.svg(p),$=L(t,{roughness:.7,fill:i,stroke:o,fillWeight:3,seed:s}),P=D.path(ct(x,S,m,d,0),$);b=p.insert(()=>(Z.debug("Rough node insert CXC",P),P),":first-child"),b.select("path:nth-child(2)").attr("style",n.join(";")),b.select("path").attr("style",h.join(";").replace("fill","stroke"))}else b=p.insert("rect",":first-child"),b.attr("style",c).attr("rx",t.rx).attr("ry",t.ry).attr("x",x).attr("y",S).attr("width",m).attr("height",d);let{subGraphTitleTopMargin:v}=_t(r);if(g.attr("transform",`translate(${t.x-y.width/2}, ${t.y-t.height/2+v})`),a){let D=g.select("span");D&&D.attr("style",a)}let k=b.node().getBBox();return t.offsetX=0,t.width=k.width,t.height=k.height,t.offsetY=y.height-t.padding/2,t.intersect=function(D){return mt(t,D)},{cluster:p,labelBBox:y}}),"rect"),ra=w((l,t)=>{let r=l.insert("g").attr("class","note-cluster").attr("id",t.id),e=r.insert("rect",":first-child"),s=0*t.padding,i=s/2;e.attr("rx",t.rx).attr("ry",t.ry).attr("x",t.x-t.width/2-i).attr("y",t.y-t.height/2-i).attr("width",t.width+s).attr("height",t.height+s).attr("fill","none");let o=e.node().getBBox();return t.width=o.width,t.height=o.height,t.intersect=function(a){return mt(t,a)},{cluster:r,labelBBox:{width:0,height:0}}},"noteGroup"),ia=w((l,t)=>C(void 0,null,function*(){let r=Q(),{themeVariables:e,handDrawnSeed:s}=r,{altBackground:i,compositeBackground:o,compositeTitleBackground:a,nodeBorder:c}=e,n=l.insert("g").attr("class",t.cssClasses).attr("id",t.id).attr("data-id",t.id).attr("data-look",t.look),h=n.insert("g",":first-child"),p=n.insert("g").attr("class","cluster-label"),f=n.append("rect"),g=p.node().appendChild(yield is(t.label,t.labelStyle,void 0,!0)),u=g.getBBox();if(K(r.flowchart.htmlLabels)){let P=g.children[0],B=J(g);u=P.getBoundingClientRect(),B.attr("width",u.width),B.attr("height",u.height)}let y=0*t.padding,m=y/2,d=(t.width<=u.width+t.padding?u.width+t.padding:t.width)+y;t.width<=u.width+t.padding?t.diff=(d-t.width)/2-t.padding:t.diff=-t.padding;let x=t.height+y,S=t.height+y-u.height-6,b=t.x-d/2,v=t.y-x/2;t.width=d;let k=t.y-t.height/2-m+u.height+2,D;if(t.look==="handDrawn"){let P=t.cssClasses.includes("statediagram-cluster-alt"),B=M.svg(n),F=t.rx||t.ry?B.path(ct(b,v,d,x,10),{roughness:.7,fill:a,fillStyle:"solid",stroke:c,seed:s}):B.rectangle(b,v,d,x,{seed:s});D=n.insert(()=>F,":first-child");let V=B.rectangle(b,k,d,S,{fill:P?i:o,fillStyle:P?"hachure":"solid",stroke:c,seed:s});D=n.insert(()=>F,":first-child"),f=n.insert(()=>V)}else D=h.insert("rect",":first-child"),D.attr("class","outer").attr("x",b).attr("y",v).attr("width",d).attr("height",x).attr("data-look",t.look),f.attr("class","inner").attr("x",b).attr("y",k).attr("width",d).attr("height",S);p.attr("transform",`translate(${t.x-u.width/2}, ${v+1-(K(r.flowchart.htmlLabels)?0:3)})`);let $=D.node().getBBox();return t.height=$.height,t.offsetX=0,t.offsetY=u.height-t.padding/2,t.labelBBox=u,t.intersect=function(P){return mt(t,P)},{cluster:n,labelBBox:u}}),"roundedWithTitle"),na=w((l,t)=>C(void 0,null,function*(){Z.info("Creating subgraph rect for ",t.id,t);let r=Q(),{themeVariables:e,handDrawnSeed:s}=r,{clusterBkg:i,clusterBorder:o}=e,{labelStyles:a,nodeStyles:c,borderStyles:n,backgroundStyles:h}=H(t),p=l.insert("g").attr("class","cluster "+t.cssClasses).attr("id",t.id).attr("data-look",t.look),f=K(r.flowchart.htmlLabels),g=p.insert("g").attr("class","cluster-label "),u=yield ut(g,t.label,{style:t.labelStyle,useHtmlLabels:f,isNode:!0,width:t.width}),y=u.getBBox();if(K(r.flowchart.htmlLabels)){let D=u.children[0],$=J(u);y=D.getBoundingClientRect(),$.attr("width",y.width),$.attr("height",y.height)}let m=t.width<=y.width+t.padding?y.width+t.padding:t.width;t.width<=y.width+t.padding?t.diff=(m-t.width)/2-t.padding:t.diff=-t.padding;let d=t.height,x=t.x-m/2,S=t.y-d/2;Z.trace("Data ",t,JSON.stringify(t));let b;if(t.look==="handDrawn"){let D=M.svg(p),$=L(t,{roughness:.7,fill:i,stroke:o,fillWeight:4,seed:s}),P=D.path(ct(x,S,m,d,t.rx),$);b=p.insert(()=>(Z.debug("Rough node insert CXC",P),P),":first-child"),b.select("path:nth-child(2)").attr("style",n.join(";")),b.select("path").attr("style",h.join(";").replace("fill","stroke"))}else b=p.insert("rect",":first-child"),b.attr("style",c).attr("rx",t.rx).attr("ry",t.ry).attr("x",x).attr("y",S).attr("width",m).attr("height",d);let{subGraphTitleTopMargin:v}=_t(r);if(g.attr("transform",`translate(${t.x-y.width/2}, ${t.y-t.height/2+v})`),a){let D=g.select("span");D&&D.attr("style",a)}let k=b.node().getBBox();return t.offsetX=0,t.width=k.width,t.height=k.height,t.offsetY=y.height-t.padding/2,t.intersect=function(D){return mt(t,D)},{cluster:p,labelBBox:y}}),"kanbanSection"),la=w((l,t)=>{let r=Q(),{themeVariables:e,handDrawnSeed:s}=r,{nodeBorder:i}=e,o=l.insert("g").attr("class",t.cssClasses).attr("id",t.id).attr("data-look",t.look),a=o.insert("g",":first-child"),c=0*t.padding,n=t.width+c;t.diff=-t.padding;let h=t.height+c,p=t.x-n/2,f=t.y-h/2;t.width=n;let g;if(t.look==="handDrawn"){let m=M.svg(o).rectangle(p,f,n,h,{fill:"lightgrey",roughness:.5,strokeLineDash:[5],stroke:i,seed:s});g=o.insert(()=>m,":first-child")}else g=a.insert("rect",":first-child"),g.attr("class","divider").attr("x",p).attr("y",f).attr("width",n).attr("height",h).attr("data-look",t.look);let u=g.node().getBBox();return t.height=u.height,t.offsetX=0,t.offsetY=0,t.intersect=function(y){return mt(t,y)},{cluster:o,labelBBox:{}}},"divider"),ca=Rs,oa={rect:Rs,squareRect:ca,roundedWithTitle:ia,noteGroup:ra,divider:la,kanbanSection:na},Ls=new Map,_a=w((l,t)=>C(void 0,null,function*(){let r=t.shape||"rect",e=yield oa[r](l,t);return Ls.set(t.id,e),e}),"insertCluster"),za=w(()=>{Ls=new Map},"clear");function As(l,t){return l.intersect(t)}w(As,"intersectNode");var ha=As;function Ts(l,t,r,e){var s=l.x,i=l.y,o=s-e.x,a=i-e.y,c=Math.sqrt(t*t*a*a+r*r*o*o),n=Math.abs(t*r*o/c);e.x<s&&(n=-n);var h=Math.abs(t*r*a/c);return e.y<i&&(h=-h),{x:s+n,y:i+h}}w(Ts,"intersectEllipse");var Ws=Ts;function Hs(l,t,r){return Ws(l,t,t,r)}w(Hs,"intersectCircle");var ga=Hs;function Is(l,t,r,e){var s,i,o,a,c,n,h,p,f,g,u,y,m,d,x;if(s=t.y-l.y,o=l.x-t.x,c=t.x*l.y-l.x*t.y,f=s*r.x+o*r.y+c,g=s*e.x+o*e.y+c,!(f!==0&&g!==0&&ns(f,g))&&(i=e.y-r.y,a=r.x-e.x,n=e.x*r.y-r.x*e.y,h=i*l.x+a*l.y+n,p=i*t.x+a*t.y+n,!(h!==0&&p!==0&&ns(h,p))&&(u=s*a-i*o,u!==0)))return y=Math.abs(u/2),m=o*n-a*c,d=m<0?(m-y)/u:(m+y)/u,m=i*c-s*n,x=m<0?(m-y)/u:(m+y)/u,{x:d,y:x}}w(Is,"intersectLine");function ns(l,t){return l*t>0}w(ns,"sameSign");var pa=Is;function Es(l,t,r){let e=l.x,s=l.y,i=[],o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY;typeof t.forEach=="function"?t.forEach(function(h){o=Math.min(o,h.x),a=Math.min(a,h.y)}):(o=Math.min(o,t.x),a=Math.min(a,t.y));let c=e-l.width/2-o,n=s-l.height/2-a;for(let h=0;h<t.length;h++){let p=t[h],f=t[h<t.length-1?h+1:0],g=pa(l,r,{x:c+p.x,y:n+p.y},{x:c+f.x,y:n+f.y});g&&i.push(g)}return i.length?(i.length>1&&i.sort(function(h,p){let f=h.x-r.x,g=h.y-r.y,u=Math.sqrt(f*f+g*g),y=p.x-r.x,m=p.y-r.y,d=Math.sqrt(y*y+m*m);return u<d?-1:u===d?0:1}),i[0]):l}w(Es,"intersectPolygon");var fa=Es,R={node:ha,circle:ga,ellipse:Ws,polygon:fa,rect:mt};function Os(l,t){let{labelStyles:r}=H(t);t.labelStyle=r;let e=_(t),s=e;e||(s="anchor");let i=l.insert("g").attr("class",s).attr("id",t.domId||t.id),o=1,{cssStyles:a}=t,c=M.svg(i),n=L(t,{fill:"black",stroke:"none",fillStyle:"solid"});t.look!=="handDrawn"&&(n.roughness=0);let h=c.circle(0,0,o*2,n),p=i.insert(()=>h,":first-child");return p.attr("class","anchor").attr("style",tt(a)),W(t,p),t.intersect=function(f){return Z.info("Circle intersect",t,o,f),R.circle(t,o,f)},i}w(Os,"anchor");function ls(l,t,r,e,s,i,o){let c=(l+r)/2,n=(t+e)/2,h=Math.atan2(e-t,r-l),p=(r-l)/2,f=(e-t)/2,g=p/s,u=f/i,y=Math.sqrt(g**2+u**2);if(y>1)throw new Error("The given radii are too small to create an arc between the points.");let m=Math.sqrt(1-y**2),d=c+m*i*Math.sin(h)*(o?-1:1),x=n-m*s*Math.cos(h)*(o?-1:1),S=Math.atan2((t-x)/i,(l-d)/s),v=Math.atan2((e-x)/i,(r-d)/s)-S;o&&v<0&&(v+=2*Math.PI),!o&&v>0&&(v-=2*Math.PI);let k=[];for(let D=0;D<20;D++){let $=D/19,P=S+$*v,B=d+s*Math.cos(P),F=x+i*Math.sin(P);k.push({x:B,y:F})}return k}w(ls,"generateArcPoints");function _s(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=i.width+t.padding+20,a=i.height+t.padding,c=a/2,n=c/(2.5+a/50),{cssStyles:h}=t,p=[{x:o/2,y:-a/2},{x:-o/2,y:-a/2},...ls(-o/2,-a/2,-o/2,a/2,n,c,!1),{x:o/2,y:a/2},...ls(o/2,a/2,o/2,-a/2,n,c,!0)],f=M.svg(s),g=L(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let u=Y(p),y=f.path(u,g),m=s.insert(()=>y,":first-child");return m.attr("class","basic label-container"),h&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",h),e&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",e),m.attr("transform",`translate(${n/2}, 0)`),W(t,m),t.intersect=function(d){return R.polygon(t,p,d)},s})}w(_s,"bowTieRect");function ot(l,t,r,e){return l.insert("polygon",":first-child").attr("points",e.map(function(s){return s.x+","+s.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-t/2+","+r/2+")")}w(ot,"insertPolygonShape");function zs(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=i.height+t.padding,a=12,c=i.width+t.padding+a,n=0,h=c,p=-o,f=0,g=[{x:n+a,y:p},{x:h,y:p},{x:h,y:f},{x:n,y:f},{x:n,y:p+a},{x:n+a,y:p}],u,{cssStyles:y}=t;if(t.look==="handDrawn"){let m=M.svg(s),d=L(t,{}),x=Y(g),S=m.path(x,d);u=s.insert(()=>S,":first-child").attr("transform",`translate(${-c/2}, ${o/2})`),y&&u.attr("style",y)}else u=ot(s,c,o,g);return e&&u.attr("style",e),W(t,u),t.intersect=function(m){return R.polygon(t,g,m)},s})}w(zs,"card");function js(l,t){let{nodeStyles:r}=H(t);t.label="";let e=l.insert("g").attr("class",_(t)).attr("id",t.domId??t.id),{cssStyles:s}=t,i=Math.max(28,t.width??0),o=[{x:0,y:i/2},{x:i/2,y:0},{x:0,y:-i/2},{x:-i/2,y:0}],a=M.svg(e),c=L(t,{});t.look!=="handDrawn"&&(c.roughness=0,c.fillStyle="solid");let n=Y(o),h=a.path(n,c),p=e.insert(()=>h,":first-child");return s&&t.look!=="handDrawn"&&p.selectAll("path").attr("style",s),r&&t.look!=="handDrawn"&&p.selectAll("path").attr("style",r),t.width=28,t.height=28,t.intersect=function(f){return R.polygon(t,o,f)},e}w(js,"choice");function Gs(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,halfPadding:o}=yield j(l,t,_(t)),a=i.width/2+o,c,{cssStyles:n}=t;if(t.look==="handDrawn"){let h=M.svg(s),p=L(t,{}),f=h.circle(0,0,a*2,p);c=s.insert(()=>f,":first-child"),c.attr("class","basic label-container").attr("style",tt(n))}else c=s.insert("circle",":first-child").attr("class","basic label-container").attr("style",e).attr("r",a).attr("cx",0).attr("cy",0);return W(t,c),t.intersect=function(h){return Z.info("Circle intersect",t,a,h),R.circle(t,a,h)},s})}w(Gs,"circle");function Fs(l){let t=Math.cos(Math.PI/4),r=Math.sin(Math.PI/4),e=l*2,s={x:e/2*t,y:e/2*r},i={x:-(e/2)*t,y:e/2*r},o={x:-(e/2)*t,y:-(e/2)*r},a={x:e/2*t,y:-(e/2)*r};return`M ${i.x},${i.y} L ${a.x},${a.y}
                   M ${s.x},${s.y} L ${o.x},${o.y}`}w(Fs,"createLine");function qs(l,t){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r,t.label="";let s=l.insert("g").attr("class",_(t)).attr("id",t.domId??t.id),i=Math.max(30,t?.width??0),{cssStyles:o}=t,a=M.svg(s),c=L(t,{});t.look!=="handDrawn"&&(c.roughness=0,c.fillStyle="solid");let n=a.circle(0,0,i*2,c),h=Fs(i),p=a.path(h,c),f=s.insert(()=>n,":first-child");return f.insert(()=>p),o&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",o),e&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",e),W(t,f),t.intersect=function(g){return Z.info("crossedCircle intersect",t,{radius:i,point:g}),R.circle(t,i,g)},s}w(qs,"crossedCircle");function nt(l,t,r,e=100,s=0,i=180){let o=[],a=s*Math.PI/180,h=(i*Math.PI/180-a)/(e-1);for(let p=0;p<e;p++){let f=a+p*h,g=l+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:-g,y:-u})}return o}w(nt,"generateCirclePoints");function Xs(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=i.width+(t.padding??0),c=i.height+(t.padding??0),n=Math.max(5,c*.1),{cssStyles:h}=t,p=[...nt(a/2,-c/2,n,30,-90,0),{x:-a/2-n,y:n},...nt(a/2+n*2,-n,n,20,-180,-270),...nt(a/2+n*2,n,n,20,-90,-180),{x:-a/2-n,y:-c/2},...nt(a/2,c/2,n,20,0,90)],f=[{x:a/2,y:-c/2-n},{x:-a/2,y:-c/2-n},...nt(a/2,-c/2,n,20,-90,0),{x:-a/2-n,y:-n},...nt(a/2+a*.1,-n,n,20,-180,-270),...nt(a/2+a*.1,n,n,20,-90,-180),{x:-a/2-n,y:c/2},...nt(a/2,c/2,n,20,0,90),{x:-a/2,y:c/2+n},{x:a/2,y:c/2+n}],g=M.svg(s),u=L(t,{fill:"none"});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let m=Y(p).replace("Z",""),d=g.path(m,u),x=Y(f),S=g.path(x,st({},u)),b=s.insert("g",":first-child");return b.insert(()=>S,":first-child").attr("stroke-opacity",0),b.insert(()=>d,":first-child"),b.attr("class","text"),h&&t.look!=="handDrawn"&&b.selectAll("path").attr("style",h),e&&t.look!=="handDrawn"&&b.selectAll("path").attr("style",e),b.attr("transform",`translate(${n}, 0)`),o.attr("transform",`translate(${-a/2+n-(i.x-(i.left??0))},${-c/2+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,b),t.intersect=function(v){return R.polygon(t,f,v)},s})}w(Xs,"curlyBraceLeft");function lt(l,t,r,e=100,s=0,i=180){let o=[],a=s*Math.PI/180,h=(i*Math.PI/180-a)/(e-1);for(let p=0;p<e;p++){let f=a+p*h,g=l+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:g,y:u})}return o}w(lt,"generateCirclePoints");function Ys(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=i.width+(t.padding??0),c=i.height+(t.padding??0),n=Math.max(5,c*.1),{cssStyles:h}=t,p=[...lt(a/2,-c/2,n,20,-90,0),{x:a/2+n,y:-n},...lt(a/2+n*2,-n,n,20,-180,-270),...lt(a/2+n*2,n,n,20,-90,-180),{x:a/2+n,y:c/2},...lt(a/2,c/2,n,20,0,90)],f=[{x:-a/2,y:-c/2-n},{x:a/2,y:-c/2-n},...lt(a/2,-c/2,n,20,-90,0),{x:a/2+n,y:-n},...lt(a/2+n*2,-n,n,20,-180,-270),...lt(a/2+n*2,n,n,20,-90,-180),{x:a/2+n,y:c/2},...lt(a/2,c/2,n,20,0,90),{x:a/2,y:c/2+n},{x:-a/2,y:c/2+n}],g=M.svg(s),u=L(t,{fill:"none"});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let m=Y(p).replace("Z",""),d=g.path(m,u),x=Y(f),S=g.path(x,st({},u)),b=s.insert("g",":first-child");return b.insert(()=>S,":first-child").attr("stroke-opacity",0),b.insert(()=>d,":first-child"),b.attr("class","text"),h&&t.look!=="handDrawn"&&b.selectAll("path").attr("style",h),e&&t.look!=="handDrawn"&&b.selectAll("path").attr("style",e),b.attr("transform",`translate(${-n}, 0)`),o.attr("transform",`translate(${-a/2+(t.padding??0)/2-(i.x-(i.left??0))},${-c/2+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,b),t.intersect=function(v){return R.polygon(t,f,v)},s})}w(Ys,"curlyBraceRight");function U(l,t,r,e=100,s=0,i=180){let o=[],a=s*Math.PI/180,h=(i*Math.PI/180-a)/(e-1);for(let p=0;p<e;p++){let f=a+p*h,g=l+r*Math.cos(f),u=t+r*Math.sin(f);o.push({x:-g,y:-u})}return o}w(U,"generateCirclePoints");function Vs(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=i.width+(t.padding??0),c=i.height+(t.padding??0),n=Math.max(5,c*.1),{cssStyles:h}=t,p=[...U(a/2,-c/2,n,30,-90,0),{x:-a/2-n,y:n},...U(a/2+n*2,-n,n,20,-180,-270),...U(a/2+n*2,n,n,20,-90,-180),{x:-a/2-n,y:-c/2},...U(a/2,c/2,n,20,0,90)],f=[...U(-a/2+n+n/2,-c/2,n,20,-90,-180),{x:a/2-n/2,y:n},...U(-a/2-n/2,-n,n,20,0,90),...U(-a/2-n/2,n,n,20,-90,0),{x:a/2-n/2,y:-n},...U(-a/2+n+n/2,c/2,n,30,-180,-270)],g=[{x:a/2,y:-c/2-n},{x:-a/2,y:-c/2-n},...U(a/2,-c/2,n,20,-90,0),{x:-a/2-n,y:-n},...U(a/2+n*2,-n,n,20,-180,-270),...U(a/2+n*2,n,n,20,-90,-180),{x:-a/2-n,y:c/2},...U(a/2,c/2,n,20,0,90),{x:-a/2,y:c/2+n},{x:a/2-n-n/2,y:c/2+n},...U(-a/2+n+n/2,-c/2,n,20,-90,-180),{x:a/2-n/2,y:n},...U(-a/2-n/2,-n,n,20,0,90),...U(-a/2-n/2,n,n,20,-90,0),{x:a/2-n/2,y:-n},...U(-a/2+n+n/2,c/2,n,30,-180,-270)],u=M.svg(s),y=L(t,{fill:"none"});t.look!=="handDrawn"&&(y.roughness=0,y.fillStyle="solid");let d=Y(p).replace("Z",""),x=u.path(d,y),b=Y(f).replace("Z",""),v=u.path(b,y),k=Y(g),D=u.path(k,st({},y)),$=s.insert("g",":first-child");return $.insert(()=>D,":first-child").attr("stroke-opacity",0),$.insert(()=>x,":first-child"),$.insert(()=>v,":first-child"),$.attr("class","text"),h&&t.look!=="handDrawn"&&$.selectAll("path").attr("style",h),e&&t.look!=="handDrawn"&&$.selectAll("path").attr("style",e),$.attr("transform",`translate(${n-n/4}, 0)`),o.attr("transform",`translate(${-a/2+(t.padding??0)/2-(i.x-(i.left??0))},${-c/2+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,$),t.intersect=function(P){return R.polygon(t,g,P)},s})}w(Vs,"curlyBraces");function Zs(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=80,a=20,c=Math.max(o,(i.width+(t.padding??0)*2)*1.25,t?.width??0),n=Math.max(a,i.height+(t.padding??0)*2,t?.height??0),h=n/2,{cssStyles:p}=t,f=M.svg(s),g=L(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let u=c,y=n,m=u-h,d=y/4,x=[{x:m,y:0},{x:d,y:0},{x:0,y:y/2},{x:d,y},{x:m,y},...cs(-m,-y/2,h,50,270,90)],S=Y(x),b=f.path(S,g),v=s.insert(()=>b,":first-child");return v.attr("class","basic label-container"),p&&t.look!=="handDrawn"&&v.selectChildren("path").attr("style",p),e&&t.look!=="handDrawn"&&v.selectChildren("path").attr("style",e),v.attr("transform",`translate(${-c/2}, ${-n/2})`),W(t,v),t.intersect=function(k){return R.polygon(t,x,k)},s})}w(Zs,"curvedTrapezoid");var ua=w((l,t,r,e,s,i)=>[`M${l},${t+i}`,`a${s},${i} 0,0,0 ${r},0`,`a${s},${i} 0,0,0 ${-r},0`,`l0,${e}`,`a${s},${i} 0,0,0 ${r},0`,`l0,${-e}`].join(" "),"createCylinderPathD"),ya=w((l,t,r,e,s,i)=>[`M${l},${t+i}`,`M${l+r},${t+i}`,`a${s},${i} 0,0,0 ${-r},0`,`l0,${e}`,`a${s},${i} 0,0,0 ${r},0`,`l0,${-e}`].join(" "),"createOuterCylinderPathD"),da=w((l,t,r,e,s,i)=>[`M${l-r/2},${-e/2}`,`a${s},${i} 0,0,0 ${r},0`].join(" "),"createInnerCylinderPathD");function Qs(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+t.padding,t.width??0),c=a/2,n=c/(2.5+a/50),h=Math.max(i.height+n+t.padding,t.height??0),p,{cssStyles:f}=t;if(t.look==="handDrawn"){let g=M.svg(s),u=ya(0,0,a,h,c,n),y=da(0,n,a,h,c,n),m=g.path(u,L(t,{})),d=g.path(y,L(t,{fill:"none"}));p=s.insert(()=>d,":first-child"),p=s.insert(()=>m,":first-child"),p.attr("class","basic label-container"),f&&p.attr("style",f)}else{let g=ua(0,0,a,h,c,n);p=s.insert("path",":first-child").attr("d",g).attr("class","basic label-container").attr("style",tt(f)).attr("style",e)}return p.attr("label-offset-y",n),p.attr("transform",`translate(${-a/2}, ${-(h/2+n)})`),W(t,p),o.attr("transform",`translate(${-(i.width/2)-(i.x-(i.left??0))}, ${-(i.height/2)+(t.padding??0)/1.5-(i.y-(i.top??0))})`),t.intersect=function(g){let u=R.rect(t,g),y=u.x-(t.x??0);if(c!=0&&(Math.abs(y)<(t.width??0)/2||Math.abs(y)==(t.width??0)/2&&Math.abs(u.y-(t.y??0))>(t.height??0)/2-n)){let m=n*n*(1-y*y/(c*c));m>0&&(m=Math.sqrt(m)),m=n-m,g.y-(t.y??0)>0&&(m=-m),u.y+=m}return u},s})}w(Qs,"cylinder");function Js(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=i.width+t.padding,c=i.height+t.padding,n=c*.2,h=-a/2,p=-c/2-n/2,{cssStyles:f}=t,g=M.svg(s),u=L(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=[{x:h,y:p+n},{x:-h,y:p+n},{x:-h,y:-p},{x:h,y:-p},{x:h,y:p},{x:-h,y:p},{x:-h,y:p+n}],m=g.polygon(y.map(x=>[x.x,x.y]),u),d=s.insert(()=>m,":first-child");return d.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",f),e&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",e),o.attr("transform",`translate(${h+(t.padding??0)/2-(i.x-(i.left??0))}, ${p+n+(t.padding??0)/2-(i.y-(i.top??0))})`),W(t,d),t.intersect=function(x){return R.rect(t,x)},s})}w(Js,"dividedRectangle");function Us(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,halfPadding:o}=yield j(l,t,_(t)),c=i.width/2+o+5,n=i.width/2+o,h,{cssStyles:p}=t;if(t.look==="handDrawn"){let f=M.svg(s),g=L(t,{roughness:.2,strokeWidth:2.5}),u=L(t,{roughness:.2,strokeWidth:1.5}),y=f.circle(0,0,c*2,g),m=f.circle(0,0,n*2,u);h=s.insert("g",":first-child"),h.attr("class",tt(t.cssClasses)).attr("style",tt(p)),h.node()?.appendChild(y),h.node()?.appendChild(m)}else{h=s.insert("g",":first-child");let f=h.insert("circle",":first-child"),g=h.insert("circle");h.attr("class","basic label-container").attr("style",e),f.attr("class","outer-circle").attr("style",e).attr("r",c).attr("cx",0).attr("cy",0),g.attr("class","inner-circle").attr("style",e).attr("r",n).attr("cx",0).attr("cy",0)}return W(t,h),t.intersect=function(f){return Z.info("DoubleCircle intersect",t,c,f),R.circle(t,c,f)},s})}w(Us,"doublecircle");function Ks(l,t,{config:{themeVariables:r}}){let{labelStyles:e,nodeStyles:s}=H(t);t.label="",t.labelStyle=e;let i=l.insert("g").attr("class",_(t)).attr("id",t.domId??t.id),o=7,{cssStyles:a}=t,c=M.svg(i),{nodeBorder:n}=r,h=L(t,{fillStyle:"solid"});t.look!=="handDrawn"&&(h.roughness=0);let p=c.circle(0,0,o*2,h),f=i.insert(()=>p,":first-child");return f.selectAll("path").attr("style",`fill: ${n} !important;`),a&&a.length>0&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",a),s&&t.look!=="handDrawn"&&f.selectAll("path").attr("style",s),W(t,f),t.intersect=function(g){return Z.info("filledCircle intersect",t,{radius:o,point:g}),R.circle(t,o,g)},i}w(Ks,"filledCircle");function te(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=i.width+(t.padding??0),c=a+i.height,n=a+i.height,h=[{x:0,y:-c},{x:n,y:-c},{x:n/2,y:0}],{cssStyles:p}=t,f=M.svg(s),g=L(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let u=Y(h),y=f.path(u,g),m=s.insert(()=>y,":first-child").attr("transform",`translate(${-c/2}, ${c/2})`);return p&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",p),e&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",e),t.width=a,t.height=c,W(t,m),o.attr("transform",`translate(${-i.width/2-(i.x-(i.left??0))}, ${-c/2+(t.padding??0)/2+(i.y-(i.top??0))})`),t.intersect=function(d){return Z.info("Triangle intersect",t,h,d),R.polygon(t,h,d)},s})}w(te,"flippedTriangle");function se(l,t,{dir:r,config:{state:e,themeVariables:s}}){let{nodeStyles:i}=H(t);t.label="";let o=l.insert("g").attr("class",_(t)).attr("id",t.domId??t.id),{cssStyles:a}=t,c=Math.max(70,t?.width??0),n=Math.max(10,t?.height??0);r==="LR"&&(c=Math.max(10,t?.width??0),n=Math.max(70,t?.height??0));let h=-1*c/2,p=-1*n/2,f=M.svg(o),g=L(t,{stroke:s.lineColor,fill:s.lineColor});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let u=f.rectangle(h,p,c,n,g),y=o.insert(()=>u,":first-child");a&&t.look!=="handDrawn"&&y.selectAll("path").attr("style",a),i&&t.look!=="handDrawn"&&y.selectAll("path").attr("style",i),W(t,y);let m=e?.padding??0;return t.width&&t.height&&(t.width+=m/2||0,t.height+=m/2||0),t.intersect=function(d){return R.rect(t,d)},o}w(se,"forkJoin");function ee(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let s=80,i=50,{shapeSvg:o,bbox:a}=yield j(l,t,_(t)),c=Math.max(s,a.width+(t.padding??0)*2,t?.width??0),n=Math.max(i,a.height+(t.padding??0)*2,t?.height??0),h=n/2,{cssStyles:p}=t,f=M.svg(o),g=L(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let u=[{x:-c/2,y:-n/2},{x:c/2-h,y:-n/2},...cs(-c/2+h,0,h,50,90,270),{x:c/2-h,y:n/2},{x:-c/2,y:n/2}],y=Y(u),m=f.path(y,g),d=o.insert(()=>m,":first-child");return d.attr("class","basic label-container"),p&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",p),e&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",e),W(t,d),t.intersect=function(x){return Z.info("Pill intersect",t,{radius:h,point:x}),R.polygon(t,u,x)},o})}w(ee,"halfRoundedRectangle");var ma=w((l,t,r,e,s)=>[`M${l+s},${t}`,`L${l+r-s},${t}`,`L${l+r},${t-e/2}`,`L${l+r-s},${t-e}`,`L${l+s},${t-e}`,`L${l},${t-e/2}`,"Z"].join(" "),"createHexagonPathD");function ae(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=4,a=i.height+t.padding,c=a/o,n=i.width+2*c+t.padding,h=[{x:c,y:0},{x:n-c,y:0},{x:n,y:-a/2},{x:n-c,y:-a},{x:c,y:-a},{x:0,y:-a/2}],p,{cssStyles:f}=t;if(t.look==="handDrawn"){let g=M.svg(s),u=L(t,{}),y=ma(0,0,n,a,c),m=g.path(y,u);p=s.insert(()=>m,":first-child").attr("transform",`translate(${-n/2}, ${a/2})`),f&&p.attr("style",f)}else p=ot(s,n,a,h);return e&&p.attr("style",e),t.width=n,t.height=a,W(t,p),t.intersect=function(g){return R.polygon(t,h,g)},s})}w(ae,"hexagon");function re(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.label="",t.labelStyle=r;let{shapeSvg:s}=yield j(l,t,_(t)),i=Math.max(30,t?.width??0),o=Math.max(30,t?.height??0),{cssStyles:a}=t,c=M.svg(s),n=L(t,{});t.look!=="handDrawn"&&(n.roughness=0,n.fillStyle="solid");let h=[{x:0,y:0},{x:i,y:0},{x:0,y:o},{x:i,y:o}],p=Y(h),f=c.path(p,n),g=s.insert(()=>f,":first-child");return g.attr("class","basic label-container"),a&&t.look!=="handDrawn"&&g.selectChildren("path").attr("style",a),e&&t.look!=="handDrawn"&&g.selectChildren("path").attr("style",e),g.attr("transform",`translate(${-i/2}, ${-o/2})`),W(t,g),t.intersect=function(u){return Z.info("Pill intersect",t,{points:h}),R.polygon(t,h,u)},s})}w(re,"hourglass");function ie(s,i,o){return C(this,arguments,function*(l,t,{config:{themeVariables:r,flowchart:e}}){let{labelStyles:a}=H(t);t.labelStyle=a;let c=t.assetHeight??48,n=t.assetWidth??48,h=Math.max(c,n),p=e?.wrappingWidth;t.width=Math.max(h,p??0);let{shapeSvg:f,bbox:g,label:u}=yield j(l,t,"icon-shape default"),y=t.pos==="t",m=h,d=h,{nodeBorder:x}=r,{stylesMap:S}=xt(t),b=-d/2,v=-m/2,k=t.label?8:0,D=M.svg(f),$=L(t,{stroke:"none",fill:"none"});t.look!=="handDrawn"&&($.roughness=0,$.fillStyle="solid");let P=D.rectangle(b,v,d,m,$),B=Math.max(d,g.width),F=m+g.height+k,V=D.rectangle(-B/2,-F/2,B,F,it(st({},$),{fill:"transparent",stroke:"none"})),X=f.insert(()=>P,":first-child"),A=f.insert(()=>V);if(t.icon){let I=f.append("g");I.html(`<g>${yield bt(t.icon,{height:h,width:h,fallbackPrefix:""})}</g>`);let N=I.node().getBBox(),G=N.width,O=N.height,T=N.x,z=N.y;I.attr("transform",`translate(${-G/2-T},${y?g.height/2+k/2-O/2-z:-g.height/2-k/2-O/2-z})`),I.attr("style",`color: ${S.get("stroke")??x};`)}return u.attr("transform",`translate(${-g.width/2-(g.x-(g.left??0))},${y?-F/2:F/2-g.height})`),X.attr("transform",`translate(0,${y?g.height/2+k/2:-g.height/2-k/2})`),W(t,A),t.intersect=function(I){if(Z.info("iconSquare intersect",t,I),!t.label)return R.rect(t,I);let N=t.x??0,G=t.y??0,O=t.height??0,T=[];return y?T=[{x:N-g.width/2,y:G-O/2},{x:N+g.width/2,y:G-O/2},{x:N+g.width/2,y:G-O/2+g.height+k},{x:N+d/2,y:G-O/2+g.height+k},{x:N+d/2,y:G+O/2},{x:N-d/2,y:G+O/2},{x:N-d/2,y:G-O/2+g.height+k},{x:N-g.width/2,y:G-O/2+g.height+k}]:T=[{x:N-d/2,y:G-O/2},{x:N+d/2,y:G-O/2},{x:N+d/2,y:G-O/2+m},{x:N+g.width/2,y:G-O/2+m},{x:N+g.width/2/2,y:G+O/2},{x:N-g.width/2,y:G+O/2},{x:N-g.width/2,y:G-O/2+m},{x:N-d/2,y:G-O/2+m}],R.polygon(t,T,I)},f})}w(ie,"icon");function ne(s,i,o){return C(this,arguments,function*(l,t,{config:{themeVariables:r,flowchart:e}}){let{labelStyles:a}=H(t);t.labelStyle=a;let c=t.assetHeight??48,n=t.assetWidth??48,h=Math.max(c,n),p=e?.wrappingWidth;t.width=Math.max(h,p??0);let{shapeSvg:f,bbox:g,label:u}=yield j(l,t,"icon-shape default"),y=20,m=t.label?8:0,d=t.pos==="t",{nodeBorder:x,mainBkg:S}=r,{stylesMap:b}=xt(t),v=M.svg(f),k=L(t,{});t.look!=="handDrawn"&&(k.roughness=0,k.fillStyle="solid");let D=b.get("fill");k.stroke=D??S;let $=f.append("g");t.icon&&$.html(`<g>${yield bt(t.icon,{height:h,width:h,fallbackPrefix:""})}</g>`);let P=$.node().getBBox(),B=P.width,F=P.height,V=P.x,X=P.y,A=Math.max(B,F)*Math.SQRT2+y*2,I=v.circle(0,0,A,k),N=Math.max(A,g.width),G=A+g.height+m,O=v.rectangle(-N/2,-G/2,N,G,it(st({},k),{fill:"transparent",stroke:"none"})),T=f.insert(()=>I,":first-child"),z=f.insert(()=>O);return $.attr("transform",`translate(${-B/2-V},${d?g.height/2+m/2-F/2-X:-g.height/2-m/2-F/2-X})`),$.attr("style",`color: ${b.get("stroke")??x};`),u.attr("transform",`translate(${-g.width/2-(g.x-(g.left??0))},${d?-G/2:G/2-g.height})`),T.attr("transform",`translate(0,${d?g.height/2+m/2:-g.height/2-m/2})`),W(t,z),t.intersect=function(q){return Z.info("iconSquare intersect",t,q),R.rect(t,q)},f})}w(ne,"iconCircle");function le(s,i,o){return C(this,arguments,function*(l,t,{config:{themeVariables:r,flowchart:e}}){let{labelStyles:a}=H(t);t.labelStyle=a;let c=t.assetHeight??48,n=t.assetWidth??48,h=Math.max(c,n),p=e?.wrappingWidth;t.width=Math.max(h,p??0);let{shapeSvg:f,bbox:g,halfPadding:u,label:y}=yield j(l,t,"icon-shape default"),m=t.pos==="t",d=h+u*2,x=h+u*2,{nodeBorder:S,mainBkg:b}=r,{stylesMap:v}=xt(t),k=-x/2,D=-d/2,$=t.label?8:0,P=M.svg(f),B=L(t,{});t.look!=="handDrawn"&&(B.roughness=0,B.fillStyle="solid");let F=v.get("fill");B.stroke=F??b;let V=P.path(ct(k,D,x,d,5),B),X=Math.max(x,g.width),A=d+g.height+$,I=P.rectangle(-X/2,-A/2,X,A,it(st({},B),{fill:"transparent",stroke:"none"})),N=f.insert(()=>V,":first-child").attr("class","icon-shape2"),G=f.insert(()=>I);if(t.icon){let O=f.append("g");O.html(`<g>${yield bt(t.icon,{height:h,width:h,fallbackPrefix:""})}</g>`);let T=O.node().getBBox(),z=T.width,q=T.height,rt=T.x,pt=T.y;O.attr("transform",`translate(${-z/2-rt},${m?g.height/2+$/2-q/2-pt:-g.height/2-$/2-q/2-pt})`),O.attr("style",`color: ${v.get("stroke")??S};`)}return y.attr("transform",`translate(${-g.width/2-(g.x-(g.left??0))},${m?-A/2:A/2-g.height})`),N.attr("transform",`translate(0,${m?g.height/2+$/2:-g.height/2-$/2})`),W(t,G),t.intersect=function(O){if(Z.info("iconSquare intersect",t,O),!t.label)return R.rect(t,O);let T=t.x??0,z=t.y??0,q=t.height??0,rt=[];return m?rt=[{x:T-g.width/2,y:z-q/2},{x:T+g.width/2,y:z-q/2},{x:T+g.width/2,y:z-q/2+g.height+$},{x:T+x/2,y:z-q/2+g.height+$},{x:T+x/2,y:z+q/2},{x:T-x/2,y:z+q/2},{x:T-x/2,y:z-q/2+g.height+$},{x:T-g.width/2,y:z-q/2+g.height+$}]:rt=[{x:T-x/2,y:z-q/2},{x:T+x/2,y:z-q/2},{x:T+x/2,y:z-q/2+d},{x:T+g.width/2,y:z-q/2+d},{x:T+g.width/2/2,y:z+q/2},{x:T-g.width/2,y:z+q/2},{x:T-g.width/2,y:z-q/2+d},{x:T-x/2,y:z-q/2+d}],R.polygon(t,rt,O)},f})}w(le,"iconRounded");function ce(s,i,o){return C(this,arguments,function*(l,t,{config:{themeVariables:r,flowchart:e}}){let{labelStyles:a}=H(t);t.labelStyle=a;let c=t.assetHeight??48,n=t.assetWidth??48,h=Math.max(c,n),p=e?.wrappingWidth;t.width=Math.max(h,p??0);let{shapeSvg:f,bbox:g,halfPadding:u,label:y}=yield j(l,t,"icon-shape default"),m=t.pos==="t",d=h+u*2,x=h+u*2,{nodeBorder:S,mainBkg:b}=r,{stylesMap:v}=xt(t),k=-x/2,D=-d/2,$=t.label?8:0,P=M.svg(f),B=L(t,{});t.look!=="handDrawn"&&(B.roughness=0,B.fillStyle="solid");let F=v.get("fill");B.stroke=F??b;let V=P.path(ct(k,D,x,d,.1),B),X=Math.max(x,g.width),A=d+g.height+$,I=P.rectangle(-X/2,-A/2,X,A,it(st({},B),{fill:"transparent",stroke:"none"})),N=f.insert(()=>V,":first-child"),G=f.insert(()=>I);if(t.icon){let O=f.append("g");O.html(`<g>${yield bt(t.icon,{height:h,width:h,fallbackPrefix:""})}</g>`);let T=O.node().getBBox(),z=T.width,q=T.height,rt=T.x,pt=T.y;O.attr("transform",`translate(${-z/2-rt},${m?g.height/2+$/2-q/2-pt:-g.height/2-$/2-q/2-pt})`),O.attr("style",`color: ${v.get("stroke")??S};`)}return y.attr("transform",`translate(${-g.width/2-(g.x-(g.left??0))},${m?-A/2:A/2-g.height})`),N.attr("transform",`translate(0,${m?g.height/2+$/2:-g.height/2-$/2})`),W(t,G),t.intersect=function(O){if(Z.info("iconSquare intersect",t,O),!t.label)return R.rect(t,O);let T=t.x??0,z=t.y??0,q=t.height??0,rt=[];return m?rt=[{x:T-g.width/2,y:z-q/2},{x:T+g.width/2,y:z-q/2},{x:T+g.width/2,y:z-q/2+g.height+$},{x:T+x/2,y:z-q/2+g.height+$},{x:T+x/2,y:z+q/2},{x:T-x/2,y:z+q/2},{x:T-x/2,y:z-q/2+g.height+$},{x:T-g.width/2,y:z-q/2+g.height+$}]:rt=[{x:T-x/2,y:z-q/2},{x:T+x/2,y:z-q/2},{x:T+x/2,y:z-q/2+d},{x:T+g.width/2,y:z-q/2+d},{x:T+g.width/2/2,y:z+q/2},{x:T-g.width/2,y:z+q/2},{x:T-g.width/2,y:z-q/2+d},{x:T-x/2,y:z-q/2+d}],R.polygon(t,rt,O)},f})}w(ce,"iconSquare");function oe(e,s,i){return C(this,arguments,function*(l,t,{config:{flowchart:r}}){let o=new Image;o.src=t?.img??"",yield o.decode();let a=Number(o.naturalWidth.toString().replace("px","")),c=Number(o.naturalHeight.toString().replace("px",""));t.imageAspectRatio=a/c;let{labelStyles:n}=H(t);t.labelStyle=n;let h=r?.wrappingWidth;t.defaultWidth=r?.wrappingWidth;let p=Math.max(t.label?h??0:0,t?.assetWidth??a),f=t.constraint==="on"&&t?.assetHeight?t.assetHeight*t.imageAspectRatio:p,g=t.constraint==="on"?f/t.imageAspectRatio:t?.assetHeight??c;t.width=Math.max(f,h??0);let{shapeSvg:u,bbox:y,label:m}=yield j(l,t,"image-shape default"),d=t.pos==="t",x=-f/2,S=-g/2,b=t.label?8:0,v=M.svg(u),k=L(t,{});t.look!=="handDrawn"&&(k.roughness=0,k.fillStyle="solid");let D=v.rectangle(x,S,f,g,k),$=Math.max(f,y.width),P=g+y.height+b,B=v.rectangle(-$/2,-P/2,$,P,it(st({},k),{fill:"none",stroke:"none"})),F=u.insert(()=>D,":first-child"),V=u.insert(()=>B);if(t.img){let X=u.append("image");X.attr("href",t.img),X.attr("width",f),X.attr("height",g),X.attr("preserveAspectRatio","none"),X.attr("transform",`translate(${-f/2},${d?P/2-g:-P/2})`)}return m.attr("transform",`translate(${-y.width/2-(y.x-(y.left??0))},${d?-g/2-y.height/2-b/2:g/2-y.height/2+b/2})`),F.attr("transform",`translate(0,${d?y.height/2+b/2:-y.height/2-b/2})`),W(t,V),t.intersect=function(X){if(Z.info("iconSquare intersect",t,X),!t.label)return R.rect(t,X);let A=t.x??0,I=t.y??0,N=t.height??0,G=[];return d?G=[{x:A-y.width/2,y:I-N/2},{x:A+y.width/2,y:I-N/2},{x:A+y.width/2,y:I-N/2+y.height+b},{x:A+f/2,y:I-N/2+y.height+b},{x:A+f/2,y:I+N/2},{x:A-f/2,y:I+N/2},{x:A-f/2,y:I-N/2+y.height+b},{x:A-y.width/2,y:I-N/2+y.height+b}]:G=[{x:A-f/2,y:I-N/2},{x:A+f/2,y:I-N/2},{x:A+f/2,y:I-N/2+g},{x:A+y.width/2,y:I-N/2+g},{x:A+y.width/2/2,y:I+N/2},{x:A-y.width/2,y:I+N/2},{x:A-y.width/2,y:I-N/2+g},{x:A-f/2,y:I-N/2+g}],R.polygon(t,G,X)},u})}w(oe,"imageSquare");function he(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=Math.max(i.width+(t.padding??0)*2,t?.width??0),a=Math.max(i.height+(t.padding??0)*2,t?.height??0),c=[{x:0,y:0},{x:o,y:0},{x:o+3*a/6,y:-a},{x:-3*a/6,y:-a}],n,{cssStyles:h}=t;if(t.look==="handDrawn"){let p=M.svg(s),f=L(t,{}),g=Y(c),u=p.path(g,f);n=s.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${a/2})`),h&&n.attr("style",h)}else n=ot(s,o,a,c);return e&&n.attr("style",e),t.width=o,t.height=a,W(t,n),t.intersect=function(p){return R.polygon(t,c,p)},s})}w(he,"inv_trapezoid");function Wt(l,t,r){return C(this,null,function*(){let{labelStyles:e,nodeStyles:s}=H(t);t.labelStyle=e;let{shapeSvg:i,bbox:o}=yield j(l,t,_(t)),a=Math.max(o.width+r.labelPaddingX*2,t?.width||0),c=Math.max(o.height+r.labelPaddingY*2,t?.height||0),n=-a/2,h=-c/2,p,{rx:f,ry:g}=t,{cssStyles:u}=t;if(r?.rx&&r.ry&&(f=r.rx,g=r.ry),t.look==="handDrawn"){let y=M.svg(i),m=L(t,{}),d=f||g?y.path(ct(n,h,a,c,f||0),m):y.rectangle(n,h,a,c,m);p=i.insert(()=>d,":first-child"),p.attr("class","basic label-container").attr("style",tt(u))}else p=i.insert("rect",":first-child"),p.attr("class","basic label-container").attr("style",s).attr("rx",tt(f)).attr("ry",tt(g)).attr("x",n).attr("y",h).attr("width",a).attr("height",c);return W(t,p),t.intersect=function(y){return R.rect(t,y)},i})}w(Wt,"drawRect");function ge(l,t){return C(this,null,function*(){let{shapeSvg:r,bbox:e,label:s}=yield j(l,t,"label"),i=r.insert("rect",":first-child");return i.attr("width",.1).attr("height",.1),r.attr("class","label edgeLabel"),s.attr("transform",`translate(${-(e.width/2)-(e.x-(e.left??0))}, ${-(e.height/2)-(e.y-(e.top??0))})`),W(t,i),t.intersect=function(c){return R.rect(t,c)},r})}w(ge,"labelRect");function pe(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=Math.max(i.width+(t.padding??0),t?.width??0),a=Math.max(i.height+(t.padding??0),t?.height??0),c=[{x:0,y:0},{x:o+3*a/6,y:0},{x:o,y:-a},{x:-(3*a)/6,y:-a}],n,{cssStyles:h}=t;if(t.look==="handDrawn"){let p=M.svg(s),f=L(t,{}),g=Y(c),u=p.path(g,f);n=s.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${a/2})`),h&&n.attr("style",h)}else n=ot(s,o,a,c);return e&&n.attr("style",e),t.width=o,t.height=a,W(t,n),t.intersect=function(p){return R.polygon(t,c,p)},s})}w(pe,"lean_left");function fe(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=Math.max(i.width+(t.padding??0),t?.width??0),a=Math.max(i.height+(t.padding??0),t?.height??0),c=[{x:-3*a/6,y:0},{x:o,y:0},{x:o+3*a/6,y:-a},{x:0,y:-a}],n,{cssStyles:h}=t;if(t.look==="handDrawn"){let p=M.svg(s),f=L(t,{}),g=Y(c),u=p.path(g,f);n=s.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${a/2})`),h&&n.attr("style",h)}else n=ot(s,o,a,c);return e&&n.attr("style",e),t.width=o,t.height=a,W(t,n),t.intersect=function(p){return R.polygon(t,c,p)},s})}w(fe,"lean_right");function ue(l,t){let{labelStyles:r,nodeStyles:e}=H(t);t.label="",t.labelStyle=r;let s=l.insert("g").attr("class",_(t)).attr("id",t.domId??t.id),{cssStyles:i}=t,o=Math.max(35,t?.width??0),a=Math.max(35,t?.height??0),c=7,n=[{x:o,y:0},{x:0,y:a+c/2},{x:o-2*c,y:a+c/2},{x:0,y:2*a},{x:o,y:a-c/2},{x:2*c,y:a-c/2}],h=M.svg(s),p=L(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let f=Y(n),g=h.path(f,p),u=s.insert(()=>g,":first-child");return i&&t.look!=="handDrawn"&&u.selectAll("path").attr("style",i),e&&t.look!=="handDrawn"&&u.selectAll("path").attr("style",e),u.attr("transform",`translate(-${o/2},${-a})`),W(t,u),t.intersect=function(y){return Z.info("lightningBolt intersect",t,y),R.polygon(t,n,y)},s}w(ue,"lightningBolt");var xa=w((l,t,r,e,s,i,o)=>[`M${l},${t+i}`,`a${s},${i} 0,0,0 ${r},0`,`a${s},${i} 0,0,0 ${-r},0`,`l0,${e}`,`a${s},${i} 0,0,0 ${r},0`,`l0,${-e}`,`M${l},${t+i+o}`,`a${s},${i} 0,0,0 ${r},0`].join(" "),"createCylinderPathD"),ba=w((l,t,r,e,s,i,o)=>[`M${l},${t+i}`,`M${l+r},${t+i}`,`a${s},${i} 0,0,0 ${-r},0`,`l0,${e}`,`a${s},${i} 0,0,0 ${r},0`,`l0,${-e}`,`M${l},${t+i+o}`,`a${s},${i} 0,0,0 ${r},0`].join(" "),"createOuterCylinderPathD"),wa=w((l,t,r,e,s,i)=>[`M${l-r/2},${-e/2}`,`a${s},${i} 0,0,0 ${r},0`].join(" "),"createInnerCylinderPathD");function ye(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0),t.width??0),c=a/2,n=c/(2.5+a/50),h=Math.max(i.height+n+(t.padding??0),t.height??0),p=h*.1,f,{cssStyles:g}=t;if(t.look==="handDrawn"){let u=M.svg(s),y=ba(0,0,a,h,c,n,p),m=wa(0,n,a,h,c,n),d=L(t,{}),x=u.path(y,d),S=u.path(m,d);s.insert(()=>S,":first-child").attr("class","line"),f=s.insert(()=>x,":first-child"),f.attr("class","basic label-container"),g&&f.attr("style",g)}else{let u=xa(0,0,a,h,c,n,p);f=s.insert("path",":first-child").attr("d",u).attr("class","basic label-container").attr("style",tt(g)).attr("style",e)}return f.attr("label-offset-y",n),f.attr("transform",`translate(${-a/2}, ${-(h/2+n)})`),W(t,f),o.attr("transform",`translate(${-(i.width/2)-(i.x-(i.left??0))}, ${-(i.height/2)+n-(i.y-(i.top??0))})`),t.intersect=function(u){let y=R.rect(t,u),m=y.x-(t.x??0);if(c!=0&&(Math.abs(m)<(t.width??0)/2||Math.abs(m)==(t.width??0)/2&&Math.abs(y.y-(t.y??0))>(t.height??0)/2-n)){let d=n*n*(1-m*m/(c*c));d>0&&(d=Math.sqrt(d)),d=n-d,u.y-(t.y??0)>0&&(d=-d),y.y+=d}return y},s})}w(ye,"linedCylinder");function de(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0)*2,t?.width??0),c=Math.max(i.height+(t.padding??0)*2,t?.height??0),n=c/4,h=c+n,{cssStyles:p}=t,f=M.svg(s),g=L(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let u=[{x:-a/2-a/2*.1,y:-h/2},{x:-a/2-a/2*.1,y:h/2},...gt(-a/2-a/2*.1,h/2,a/2+a/2*.1,h/2,n,.8),{x:a/2+a/2*.1,y:-h/2},{x:-a/2-a/2*.1,y:-h/2},{x:-a/2,y:-h/2},{x:-a/2,y:h/2*1.1},{x:-a/2,y:-h/2}],y=f.polygon(u.map(d=>[d.x,d.y]),g),m=s.insert(()=>y,":first-child");return m.attr("class","basic label-container"),p&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",p),e&&t.look!=="handDrawn"&&m.selectAll("path").attr("style",e),m.attr("transform",`translate(0,${-n/2})`),o.attr("transform",`translate(${-a/2+(t.padding??0)+a/2*.1/2-(i.x-(i.left??0))},${-c/2+(t.padding??0)-n/2-(i.y-(i.top??0))})`),W(t,m),t.intersect=function(d){return R.polygon(t,u,d)},s})}w(de,"linedWaveEdgedRect");function me(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0)*2,t?.width??0),c=Math.max(i.height+(t.padding??0)*2,t?.height??0),n=5,h=-a/2,p=-c/2,{cssStyles:f}=t,g=M.svg(s),u=L(t,{}),y=[{x:h-n,y:p+n},{x:h-n,y:p+c+n},{x:h+a-n,y:p+c+n},{x:h+a-n,y:p+c},{x:h+a,y:p+c},{x:h+a,y:p+c-n},{x:h+a+n,y:p+c-n},{x:h+a+n,y:p-n},{x:h+n,y:p-n},{x:h+n,y:p},{x:h,y:p},{x:h,y:p+n}],m=[{x:h,y:p+n},{x:h+a-n,y:p+n},{x:h+a-n,y:p+c},{x:h+a,y:p+c},{x:h+a,y:p},{x:h,y:p}];t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let d=Y(y),x=g.path(d,u),S=Y(m),b=g.path(S,it(st({},u),{fill:"none"})),v=s.insert(()=>b,":first-child");return v.insert(()=>x,":first-child"),v.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&v.selectAll("path").attr("style",f),e&&t.look!=="handDrawn"&&v.selectAll("path").attr("style",e),o.attr("transform",`translate(${-(i.width/2)-n-(i.x-(i.left??0))}, ${-(i.height/2)+n-(i.y-(i.top??0))})`),W(t,v),t.intersect=function(k){return R.polygon(t,y,k)},s})}w(me,"multiRect");function xe(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0)*2,t?.width??0),c=Math.max(i.height+(t.padding??0)*2,t?.height??0),n=c/4,h=c+n,p=-a/2,f=-h/2,g=5,{cssStyles:u}=t,y=gt(p-g,f+h+g,p+a-g,f+h+g,n,.8),m=y?.[y.length-1],d=[{x:p-g,y:f+g},{x:p-g,y:f+h+g},...y,{x:p+a-g,y:m.y-g},{x:p+a,y:m.y-g},{x:p+a,y:m.y-2*g},{x:p+a+g,y:m.y-2*g},{x:p+a+g,y:f-g},{x:p+g,y:f-g},{x:p+g,y:f},{x:p,y:f},{x:p,y:f+g}],x=[{x:p,y:f+g},{x:p+a-g,y:f+g},{x:p+a-g,y:m.y-g},{x:p+a,y:m.y-g},{x:p+a,y:f},{x:p,y:f}],S=M.svg(s),b=L(t,{});t.look!=="handDrawn"&&(b.roughness=0,b.fillStyle="solid");let v=Y(d),k=S.path(v,b),D=Y(x),$=S.path(D,b),P=s.insert(()=>k,":first-child");return P.insert(()=>$),P.attr("class","basic label-container"),u&&t.look!=="handDrawn"&&P.selectAll("path").attr("style",u),e&&t.look!=="handDrawn"&&P.selectAll("path").attr("style",e),P.attr("transform",`translate(0,${-n/2})`),o.attr("transform",`translate(${-(i.width/2)-g-(i.x-(i.left??0))}, ${-(i.height/2)+g-n/2-(i.y-(i.top??0))})`),W(t,P),t.intersect=function(B){return R.polygon(t,d,B)},s})}w(xe,"multiWaveEdgedRectangle");function be(e,s,i){return C(this,arguments,function*(l,t,{config:{themeVariables:r}}){let{labelStyles:o,nodeStyles:a}=H(t);t.labelStyle=o,t.useHtmlLabels||It().flowchart?.htmlLabels!==!1||(t.centerLabel=!0);let{shapeSvg:n,bbox:h}=yield j(l,t,_(t)),p=Math.max(h.width+(t.padding??0)*2,t?.width??0),f=Math.max(h.height+(t.padding??0)*2,t?.height??0),g=-p/2,u=-f/2,{cssStyles:y}=t,m=M.svg(n),d=L(t,{fill:r.noteBkgColor,stroke:r.noteBorderColor});t.look!=="handDrawn"&&(d.roughness=0,d.fillStyle="solid");let x=m.rectangle(g,u,p,f,d),S=n.insert(()=>x,":first-child");return S.attr("class","basic label-container"),y&&t.look!=="handDrawn"&&S.selectAll("path").attr("style",y),a&&t.look!=="handDrawn"&&S.selectAll("path").attr("style",a),W(t,S),t.intersect=function(b){return R.rect(t,b)},n})}w(be,"note");var Sa=w((l,t,r)=>[`M${l+r/2},${t}`,`L${l+r},${t-r/2}`,`L${l+r/2},${t-r}`,`L${l},${t-r/2}`,"Z"].join(" "),"createDecisionBoxPathD");function we(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=i.width+t.padding,a=i.height+t.padding,c=o+a,n=[{x:c/2,y:0},{x:c,y:-c/2},{x:c/2,y:-c},{x:0,y:-c/2}],h,{cssStyles:p}=t;if(t.look==="handDrawn"){let f=M.svg(s),g=L(t,{}),u=Sa(0,0,c),y=f.path(u,g);h=s.insert(()=>y,":first-child").attr("transform",`translate(${-c/2}, ${c/2})`),p&&h.attr("style",p)}else h=ot(s,c,c,n);return e&&h.attr("style",e),W(t,h),t.intersect=function(f){return Z.debug(`APA12 Intersect called SPLIT
point:`,f,`
node:
`,t,`
res:`,R.polygon(t,n,f)),R.polygon(t,n,f)},s})}w(we,"question");function Se(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0),t?.width??0),c=Math.max(i.height+(t.padding??0),t?.height??0),n=-a/2,h=-c/2,p=h/2,f=[{x:n+p,y:h},{x:n,y:0},{x:n+p,y:-h},{x:-n,y:-h},{x:-n,y:h}],{cssStyles:g}=t,u=M.svg(s),y=L(t,{});t.look!=="handDrawn"&&(y.roughness=0,y.fillStyle="solid");let m=Y(f),d=u.path(m,y),x=s.insert(()=>d,":first-child");return x.attr("class","basic label-container"),g&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",g),e&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",e),x.attr("transform",`translate(${-p/2},0)`),o.attr("transform",`translate(${-p/2-i.width/2-(i.x-(i.left??0))}, ${-(i.height/2)-(i.y-(i.top??0))})`),W(t,x),t.intersect=function(S){return R.polygon(t,f,S)},s})}w(Se,"rect_left_inv_arrow");function Me(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let s;t.cssClasses?s="node "+t.cssClasses:s="node default";let i=l.insert("g").attr("class",s).attr("id",t.domId||t.id),o=i.insert("g"),a=i.insert("g").attr("class","label").attr("style",e),c=t.description,n=t.label,h=a.node().appendChild(yield is(n,t.labelStyle,!0,!0)),p={width:0,height:0};if(K(Q()?.flowchart?.htmlLabels)){let $=h.children[0],P=J(h);p=$.getBoundingClientRect(),P.attr("width",p.width),P.attr("height",p.height)}Z.info("Text 2",c);let f=c||[],g=h.getBBox(),u=a.node().appendChild(yield is(f.join?f.join("<br/>"):f,t.labelStyle,!0,!0)),y=u.children[0],m=J(u);p=y.getBoundingClientRect(),m.attr("width",p.width),m.attr("height",p.height);let d=(t.padding||0)/2;J(u).attr("transform","translate( "+(p.width>g.width?0:(g.width-p.width)/2)+", "+(g.height+d+5)+")"),J(h).attr("transform","translate( "+(p.width<g.width?0:-(g.width-p.width)/2)+", 0)"),p=a.node().getBBox(),a.attr("transform","translate("+-p.width/2+", "+(-p.height/2-d+3)+")");let x=p.width+(t.padding||0),S=p.height+(t.padding||0),b=-p.width/2-d,v=-p.height/2-d,k,D;if(t.look==="handDrawn"){let $=M.svg(i),P=L(t,{}),B=$.path(ct(b,v,x,S,t.rx||0),P),F=$.line(-p.width/2-d,-p.height/2-d+g.height+d,p.width/2+d,-p.height/2-d+g.height+d,P);D=i.insert(()=>(Z.debug("Rough node insert CXC",B),F),":first-child"),k=i.insert(()=>(Z.debug("Rough node insert CXC",B),B),":first-child")}else k=o.insert("rect",":first-child"),D=o.insert("line"),k.attr("class","outer title-state").attr("style",e).attr("x",-p.width/2-d).attr("y",-p.height/2-d).attr("width",p.width+(t.padding||0)).attr("height",p.height+(t.padding||0)),D.attr("class","divider").attr("x1",-p.width/2-d).attr("x2",p.width/2+d).attr("y1",-p.height/2-d+g.height+d).attr("y2",-p.height/2-d+g.height+d);return W(t,k),t.intersect=function($){return R.rect(t,$)},i})}w(Me,"rectWithTitle");function ke(l,t){return C(this,null,function*(){let r={rx:5,ry:5,classes:"",labelPaddingX:(t?.padding||0)*1,labelPaddingY:(t?.padding||0)*1};return Wt(l,t,r)})}w(ke,"roundedRect");function ve(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=t?.padding??0,c=Math.max(i.width+(t.padding??0)*2,t?.width??0),n=Math.max(i.height+(t.padding??0)*2,t?.height??0),h=-i.width/2-a,p=-i.height/2-a,{cssStyles:f}=t,g=M.svg(s),u=L(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=[{x:h,y:p},{x:h+c+8,y:p},{x:h+c+8,y:p+n},{x:h-8,y:p+n},{x:h-8,y:p},{x:h,y:p},{x:h,y:p+n}],m=g.polygon(y.map(x=>[x.x,x.y]),u),d=s.insert(()=>m,":first-child");return d.attr("class","basic label-container").attr("style",tt(f)),e&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",e),f&&t.look!=="handDrawn"&&d.selectAll("path").attr("style",e),o.attr("transform",`translate(${-c/2+4+(t.padding??0)-(i.x-(i.left??0))},${-n/2+(t.padding??0)-(i.y-(i.top??0))})`),W(t,d),t.intersect=function(x){return R.rect(t,x)},s})}w(ve,"shadedProcess");function $e(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0)*2,t?.width??0),c=Math.max(i.height+(t.padding??0)*2,t?.height??0),n=-a/2,h=-c/2,{cssStyles:p}=t,f=M.svg(s),g=L(t,{});t.look!=="handDrawn"&&(g.roughness=0,g.fillStyle="solid");let u=[{x:n,y:h},{x:n,y:h+c},{x:n+a,y:h+c},{x:n+a,y:h-c/2}],y=Y(u),m=f.path(y,g),d=s.insert(()=>m,":first-child");return d.attr("class","basic label-container"),p&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",p),e&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",e),d.attr("transform",`translate(0, ${c/4})`),o.attr("transform",`translate(${-a/2+(t.padding??0)-(i.x-(i.left??0))}, ${-c/4+(t.padding??0)-(i.y-(i.top??0))})`),W(t,d),t.intersect=function(x){return R.polygon(t,u,x)},s})}w($e,"slopedRect");function De(l,t){return C(this,null,function*(){let r={rx:0,ry:0,classes:"",labelPaddingX:(t?.padding||0)*2,labelPaddingY:(t?.padding||0)*1};return Wt(l,t,r)})}w(De,"squareRect");function Pe(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=i.height+t.padding,a=i.width+o/4+t.padding,c,{cssStyles:n}=t;if(t.look==="handDrawn"){let h=M.svg(s),p=L(t,{}),f=ct(-a/2,-o/2,a,o,o/2),g=h.path(f,p);c=s.insert(()=>g,":first-child"),c.attr("class","basic label-container").attr("style",tt(n))}else c=s.insert("rect",":first-child"),c.attr("class","basic label-container").attr("style",e).attr("rx",o/2).attr("ry",o/2).attr("x",-a/2).attr("y",-o/2).attr("width",a).attr("height",o);return W(t,c),t.intersect=function(h){return R.rect(t,h)},s})}w(Pe,"stadium");function Ce(l,t){return C(this,null,function*(){return Wt(l,t,{rx:5,ry:5,classes:"flowchart-node"})})}w(Ce,"state");function Be(l,t,{config:{themeVariables:r}}){let{labelStyles:e,nodeStyles:s}=H(t);t.labelStyle=e;let{cssStyles:i}=t,{lineColor:o,stateBorder:a,nodeBorder:c}=r,n=l.insert("g").attr("class","node default").attr("id",t.domId||t.id),h=M.svg(n),p=L(t,{});t.look!=="handDrawn"&&(p.roughness=0,p.fillStyle="solid");let f=h.circle(0,0,14,it(st({},p),{stroke:o,strokeWidth:2})),g=a??c,u=h.circle(0,0,5,it(st({},p),{fill:g,stroke:g,strokeWidth:2,fillStyle:"solid"})),y=n.insert(()=>f,":first-child");return y.insert(()=>u),i&&y.selectAll("path").attr("style",i),s&&y.selectAll("path").attr("style",s),W(t,y),t.intersect=function(m){return R.circle(t,7,m)},n}w(Be,"stateEnd");function Ne(l,t,{config:{themeVariables:r}}){let{lineColor:e}=r,s=l.insert("g").attr("class","node default").attr("id",t.domId||t.id),i;if(t.look==="handDrawn"){let a=M.svg(s).circle(0,0,14,ea(e));i=s.insert(()=>a),i.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14)}else i=s.insert("circle",":first-child"),i.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14);return W(t,i),t.intersect=function(o){return R.circle(t,7,o)},s}w(Ne,"stateStart");function Re(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=(t?.padding||0)/2,a=i.width+t.padding,c=i.height+t.padding,n=-i.width/2-o,h=-i.height/2-o,p=[{x:0,y:0},{x:a,y:0},{x:a,y:-c},{x:0,y:-c},{x:0,y:0},{x:-8,y:0},{x:a+8,y:0},{x:a+8,y:-c},{x:-8,y:-c},{x:-8,y:0}];if(t.look==="handDrawn"){let f=M.svg(s),g=L(t,{}),u=f.rectangle(n-8,h,a+16,c,g),y=f.line(n,h,n,h+c,g),m=f.line(n+a,h,n+a,h+c,g);s.insert(()=>y,":first-child"),s.insert(()=>m,":first-child");let d=s.insert(()=>u,":first-child"),{cssStyles:x}=t;d.attr("class","basic label-container").attr("style",tt(x)),W(t,d)}else{let f=ot(s,a,c,p);e&&f.attr("style",e),W(t,f)}return t.intersect=function(f){return R.polygon(t,p,f)},s})}w(Re,"subroutine");function Le(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=Math.max(i.width+(t.padding??0)*2,t?.width??0),a=Math.max(i.height+(t.padding??0)*2,t?.height??0),c=-o/2,n=-a/2,h=.2*a,p=.2*a,{cssStyles:f}=t,g=M.svg(s),u=L(t,{}),y=[{x:c-h/2,y:n},{x:c+o+h/2,y:n},{x:c+o+h/2,y:n+a},{x:c-h/2,y:n+a}],m=[{x:c+o-h/2,y:n+a},{x:c+o+h/2,y:n+a},{x:c+o+h/2,y:n+a-p}];t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let d=Y(y),x=g.path(d,u),S=Y(m),b=g.path(S,it(st({},u),{fillStyle:"solid"})),v=s.insert(()=>b,":first-child");return v.insert(()=>x,":first-child"),v.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&v.selectAll("path").attr("style",f),e&&t.look!=="handDrawn"&&v.selectAll("path").attr("style",e),W(t,v),t.intersect=function(k){return R.polygon(t,y,k)},s})}w(Le,"taggedRect");function Ae(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0)*2,t?.width??0),c=Math.max(i.height+(t.padding??0)*2,t?.height??0),n=c/4,h=.2*a,p=.2*c,f=c+n,{cssStyles:g}=t,u=M.svg(s),y=L(t,{});t.look!=="handDrawn"&&(y.roughness=0,y.fillStyle="solid");let m=[{x:-a/2-a/2*.1,y:f/2},...gt(-a/2-a/2*.1,f/2,a/2+a/2*.1,f/2,n,.8),{x:a/2+a/2*.1,y:-f/2},{x:-a/2-a/2*.1,y:-f/2}],d=-a/2+a/2*.1,x=-f/2-p*.4,S=[{x:d+a-h,y:(x+c)*1.4},{x:d+a,y:x+c-p},{x:d+a,y:(x+c)*.9},...gt(d+a,(x+c)*1.3,d+a-h,(x+c)*1.5,-c*.03,.5)],b=Y(m),v=u.path(b,y),k=Y(S),D=u.path(k,it(st({},y),{fillStyle:"solid"})),$=s.insert(()=>D,":first-child");return $.insert(()=>v,":first-child"),$.attr("class","basic label-container"),g&&t.look!=="handDrawn"&&$.selectAll("path").attr("style",g),e&&t.look!=="handDrawn"&&$.selectAll("path").attr("style",e),$.attr("transform",`translate(0,${-n/2})`),o.attr("transform",`translate(${-a/2+(t.padding??0)-(i.x-(i.left??0))},${-c/2+(t.padding??0)-n/2-(i.y-(i.top??0))})`),W(t,$),t.intersect=function(P){return R.polygon(t,m,P)},s})}w(Ae,"taggedWaveEdgedRectangle");function Te(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=Math.max(i.width+t.padding,t?.width||0),a=Math.max(i.height+t.padding,t?.height||0),c=-o/2,n=-a/2,h=s.insert("rect",":first-child");return h.attr("class","text").attr("style",e).attr("rx",0).attr("ry",0).attr("x",c).attr("y",n).attr("width",o).attr("height",a),W(t,h),t.intersect=function(p){return R.rect(t,p)},s})}w(Te,"text");var Ma=w((l,t,r,e,s,i)=>`M${l},${t}
    a${s},${i} 0,0,1 0,${-e}
    l${r},0
    a${s},${i} 0,0,1 0,${e}
    M${r},${-e}
    a${s},${i} 0,0,0 0,${e}
    l${-r},0`,"createCylinderPathD"),ka=w((l,t,r,e,s,i)=>[`M${l},${t}`,`M${l+r},${t}`,`a${s},${i} 0,0,0 0,${-e}`,`l${-r},0`,`a${s},${i} 0,0,0 0,${e}`,`l${r},0`].join(" "),"createOuterCylinderPathD"),va=w((l,t,r,e,s,i)=>[`M${l+r/2},${-e/2}`,`a${s},${i} 0,0,0 0,${e}`].join(" "),"createInnerCylinderPathD");function We(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o,halfPadding:a}=yield j(l,t,_(t)),c=t.look==="neo"?a*2:a,n=i.height+c,h=n/2,p=h/(2.5+n/50),f=i.width+p+c,{cssStyles:g}=t,u;if(t.look==="handDrawn"){let y=M.svg(s),m=ka(0,0,f,n,p,h),d=va(0,0,f,n,p,h),x=y.path(m,L(t,{})),S=y.path(d,L(t,{fill:"none"}));u=s.insert(()=>S,":first-child"),u=s.insert(()=>x,":first-child"),u.attr("class","basic label-container"),g&&u.attr("style",g)}else{let y=Ma(0,0,f,n,p,h);u=s.insert("path",":first-child").attr("d",y).attr("class","basic label-container").attr("style",tt(g)).attr("style",e),u.attr("class","basic label-container"),g&&u.selectAll("path").attr("style",g),e&&u.selectAll("path").attr("style",e)}return u.attr("label-offset-x",p),u.attr("transform",`translate(${-f/2}, ${n/2} )`),o.attr("transform",`translate(${-(i.width/2)-p-(i.x-(i.left??0))}, ${-(i.height/2)-(i.y-(i.top??0))})`),W(t,u),t.intersect=function(y){let m=R.rect(t,y),d=m.y-(t.y??0);if(h!=0&&(Math.abs(d)<(t.height??0)/2||Math.abs(d)==(t.height??0)/2&&Math.abs(m.x-(t.x??0))>(t.width??0)/2-p)){let x=p*p*(1-d*d/(h*h));x!=0&&(x=Math.sqrt(Math.abs(x))),x=p-x,y.x-(t.x??0)>0&&(x=-x),m.x+=x}return m},s})}w(We,"tiltedCylinder");function He(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=i.width+t.padding,a=i.height+t.padding,c=[{x:-3*a/6,y:0},{x:o+3*a/6,y:0},{x:o,y:-a},{x:0,y:-a}],n,{cssStyles:h}=t;if(t.look==="handDrawn"){let p=M.svg(s),f=L(t,{}),g=Y(c),u=p.path(g,f);n=s.insert(()=>u,":first-child").attr("transform",`translate(${-o/2}, ${a/2})`),h&&n.attr("style",h)}else n=ot(s,o,a,c);return e&&n.attr("style",e),t.width=o,t.height=a,W(t,n),t.intersect=function(p){return R.polygon(t,c,p)},s})}w(He,"trapezoid");function Ie(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=60,a=20,c=Math.max(o,i.width+(t.padding??0)*2,t?.width??0),n=Math.max(a,i.height+(t.padding??0)*2,t?.height??0),{cssStyles:h}=t,p=M.svg(s),f=L(t,{});t.look!=="handDrawn"&&(f.roughness=0,f.fillStyle="solid");let g=[{x:-c/2*.8,y:-n/2},{x:c/2*.8,y:-n/2},{x:c/2,y:-n/2*.6},{x:c/2,y:n/2},{x:-c/2,y:n/2},{x:-c/2,y:-n/2*.6}],u=Y(g),y=p.path(u,f),m=s.insert(()=>y,":first-child");return m.attr("class","basic label-container"),h&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",h),e&&t.look!=="handDrawn"&&m.selectChildren("path").attr("style",e),W(t,m),t.intersect=function(d){return R.polygon(t,g,d)},s})}w(Ie,"trapezoidalPentagon");function Ee(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=K(Q().flowchart?.htmlLabels),c=i.width+(t.padding??0),n=c+i.height,h=c+i.height,p=[{x:0,y:0},{x:h,y:0},{x:h/2,y:-n}],{cssStyles:f}=t,g=M.svg(s),u=L(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=Y(p),m=g.path(y,u),d=s.insert(()=>m,":first-child").attr("transform",`translate(${-n/2}, ${n/2})`);return f&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",f),e&&t.look!=="handDrawn"&&d.selectChildren("path").attr("style",e),t.width=c,t.height=n,W(t,d),o.attr("transform",`translate(${-i.width/2-(i.x-(i.left??0))}, ${n/2-(i.height+(t.padding??0)/(a?2:1)-(i.y-(i.top??0)))})`),t.intersect=function(x){return Z.info("Triangle intersect",t,p,x),R.polygon(t,p,x)},s})}w(Ee,"triangle");function Oe(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0)*2,t?.width??0),c=Math.max(i.height+(t.padding??0)*2,t?.height??0),n=c/8,h=c+n,{cssStyles:p}=t,g=70-a,u=g>0?g/2:0,y=M.svg(s),m=L(t,{});t.look!=="handDrawn"&&(m.roughness=0,m.fillStyle="solid");let d=[{x:-a/2-u,y:h/2},...gt(-a/2-u,h/2,a/2+u,h/2,n,.8),{x:a/2+u,y:-h/2},{x:-a/2-u,y:-h/2}],x=Y(d),S=y.path(x,m),b=s.insert(()=>S,":first-child");return b.attr("class","basic label-container"),p&&t.look!=="handDrawn"&&b.selectAll("path").attr("style",p),e&&t.look!=="handDrawn"&&b.selectAll("path").attr("style",e),b.attr("transform",`translate(0,${-n/2})`),o.attr("transform",`translate(${-a/2+(t.padding??0)-(i.x-(i.left??0))},${-c/2+(t.padding??0)-n-(i.y-(i.top??0))})`),W(t,b),t.intersect=function(v){return R.polygon(t,d,v)},s})}w(Oe,"waveEdgedRectangle");function _e(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i}=yield j(l,t,_(t)),o=100,a=50,c=Math.max(i.width+(t.padding??0)*2,t?.width??0),n=Math.max(i.height+(t.padding??0)*2,t?.height??0),h=c/n,p=c,f=n;p>f*h?f=p/h:p=f*h,p=Math.max(p,o),f=Math.max(f,a);let g=Math.min(f*.2,f/4),u=f+g*2,{cssStyles:y}=t,m=M.svg(s),d=L(t,{});t.look!=="handDrawn"&&(d.roughness=0,d.fillStyle="solid");let x=[{x:-p/2,y:u/2},...gt(-p/2,u/2,p/2,u/2,g,1),{x:p/2,y:-u/2},...gt(p/2,-u/2,-p/2,-u/2,g,-1)],S=Y(x),b=m.path(S,d),v=s.insert(()=>b,":first-child");return v.attr("class","basic label-container"),y&&t.look!=="handDrawn"&&v.selectAll("path").attr("style",y),e&&t.look!=="handDrawn"&&v.selectAll("path").attr("style",e),W(t,v),t.intersect=function(k){return R.polygon(t,x,k)},s})}w(_e,"waveRectangle");function ze(l,t){return C(this,null,function*(){let{labelStyles:r,nodeStyles:e}=H(t);t.labelStyle=r;let{shapeSvg:s,bbox:i,label:o}=yield j(l,t,_(t)),a=Math.max(i.width+(t.padding??0)*2,t?.width??0),c=Math.max(i.height+(t.padding??0)*2,t?.height??0),n=5,h=-a/2,p=-c/2,{cssStyles:f}=t,g=M.svg(s),u=L(t,{}),y=[{x:h-n,y:p-n},{x:h-n,y:p+c},{x:h+a,y:p+c},{x:h+a,y:p-n}],m=`M${h-n},${p-n} L${h+a},${p-n} L${h+a},${p+c} L${h-n},${p+c} L${h-n},${p-n}
                M${h-n},${p} L${h+a},${p}
                M${h},${p-n} L${h},${p+c}`;t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let d=g.path(m,u),x=s.insert(()=>d,":first-child");return x.attr("transform",`translate(${n/2}, ${n/2})`),x.attr("class","basic label-container"),f&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",f),e&&t.look!=="handDrawn"&&x.selectAll("path").attr("style",e),o.attr("transform",`translate(${-(i.width/2)+n/2-(i.x-(i.left??0))}, ${-(i.height/2)+n/2-(i.y-(i.top??0))})`),W(t,x),t.intersect=function(S){return R.polygon(t,y,S)},s})}w(ze,"windowPane");function je(i,o,a,c){return C(this,arguments,function*(l,t,r,e,s=r.class.padding??12){let n=e?0:3,h=l.insert("g").attr("class",_(t)).attr("id",t.domId||t.id),p=null,f=null,g=null,u=null,y=0,m=0,d=0;if(p=h.insert("g").attr("class","annotation-group text"),t.annotations.length>0){let k=t.annotations[0];yield $t(p,{text:`\xAB${k}\xBB`},0),y=p.node().getBBox().height}f=h.insert("g").attr("class","label-group text"),yield $t(f,t,0,["font-weight: bolder"]);let x=f.node().getBBox();m=x.height,g=h.insert("g").attr("class","members-group text");let S=0;for(let k of t.members){let D=yield $t(g,k,S,[k.parseClassifier()]);S+=D+n}d=g.node().getBBox().height,d<=0&&(d=s/2),u=h.insert("g").attr("class","methods-group text");let b=0;for(let k of t.methods){let D=yield $t(u,k,b,[k.parseClassifier()]);b+=D+n}let v=h.node().getBBox();if(p!==null){let k=p.node().getBBox();p.attr("transform",`translate(${-k.width/2})`)}return f.attr("transform",`translate(${-x.width/2}, ${y})`),v=h.node().getBBox(),g.attr("transform",`translate(0, ${y+m+s*2})`),v=h.node().getBBox(),u.attr("transform",`translate(0, ${y+m+(d?d+s*4:s*2)})`),v=h.node().getBBox(),{shapeSvg:h,bbox:v}})}w(je,"textHelper");function $t(s,i,o){return C(this,arguments,function*(l,t,r,e=[]){let a=l.insert("g").attr("class","label").attr("style",e.join("; ")),c=It(),n="useHtmlLabels"in t?t.useHtmlLabels:K(c.htmlLabels)??!0,h="";"text"in t?h=t.text:h=t.label,!n&&h.startsWith("\\")&&(h=h.substring(1)),Ot(h)&&(n=!0);let p=yield ut(a,ps(wt(h)),{width:fs(h,c)+50,classes:"markdown-node-label",useHtmlLabels:n},c),f,g=1;if(n){let u=p.children[0],y=J(p);g=u.innerHTML.split("<br>").length,u.innerHTML.includes("</math>")&&(g+=u.innerHTML.split("<mrow>").length-1);let m=u.getElementsByTagName("img");if(m){let d=h.replace(/<img[^>]*>/g,"").trim()==="";yield Promise.all([...m].map(x=>new Promise(S=>{function b(){if(x.style.display="flex",x.style.flexDirection="column",d){let v=c.fontSize?.toString()??window.getComputedStyle(document.body).fontSize,D=parseInt(v,10)*5+"px";x.style.minWidth=D,x.style.maxWidth=D}else x.style.width="100%";S(x)}w(b,"setupImage"),setTimeout(()=>{x.complete&&b()}),x.addEventListener("error",b),x.addEventListener("load",b)})))}f=u.getBoundingClientRect(),y.attr("width",f.width),y.attr("height",f.height)}else{e.includes("font-weight: bolder")&&J(p).selectAll("tspan").attr("font-weight",""),g=p.children.length;let u=p.children[0];(p.textContent===""||p.textContent.includes("&gt"))&&(u.textContent=h[0]+h.substring(1).replaceAll("&gt;",">").replaceAll("&lt;","<").trim(),h[1]===" "&&(u.textContent=u.textContent[0]+" "+u.textContent.substring(1))),u.textContent==="undefined"&&(u.textContent=""),f=p.getBBox()}return a.attr("transform","translate(0,"+(-f.height/(2*g)+r)+")"),f.height})}w($t,"addText");function Ge(l,t){return C(this,null,function*(){let r=Q(),e=r.class.padding??12,s=e,i=t.useHtmlLabels??K(r.htmlLabels)??!0,o=t;o.annotations=o.annotations??[],o.members=o.members??[],o.methods=o.methods??[];let{shapeSvg:a,bbox:c}=yield je(l,t,r,i,s),{labelStyles:n,nodeStyles:h}=H(t);t.labelStyle=n,t.cssStyles=o.styles||"";let p=o.styles?.join(";")||h||"";t.cssStyles||(t.cssStyles=p.replaceAll("!important","").split(";"));let f=o.members.length===0&&o.methods.length===0&&!r.class?.hideEmptyMembersBox,g=M.svg(a),u=L(t,{});t.look!=="handDrawn"&&(u.roughness=0,u.fillStyle="solid");let y=c.width,m=c.height;o.members.length===0&&o.methods.length===0?m+=s:o.members.length>0&&o.methods.length===0&&(m+=s*2);let d=-y/2,x=-m/2,S=g.rectangle(d-e,x-e-(f?e:o.members.length===0&&o.methods.length===0?-e/2:0),y+2*e,m+2*e+(f?e*2:o.members.length===0&&o.methods.length===0?-e:0),u),b=a.insert(()=>S,":first-child");b.attr("class","basic label-container");let v=b.node().getBBox();a.selectAll(".text").each((P,B,F)=>{let V=J(F[B]),X=V.attr("transform"),A=0;if(X){let O=RegExp(/translate\(([^,]+),([^)]+)\)/).exec(X);O&&(A=parseFloat(O[2]))}let I=A+x+e-(f?e:o.members.length===0&&o.methods.length===0?-e/2:0);i||(I-=4);let N=d;(V.attr("class").includes("label-group")||V.attr("class").includes("annotation-group"))&&(N=-V.node()?.getBBox().width/2||0,a.selectAll("text").each(function(G,O,T){window.getComputedStyle(T[O]).textAnchor==="middle"&&(N=0)})),V.attr("transform",`translate(${N}, ${I})`)});let k=a.select(".annotation-group").node().getBBox().height-(f?e/2:0)||0,D=a.select(".label-group").node().getBBox().height-(f?e/2:0)||0,$=a.select(".members-group").node().getBBox().height-(f?e/2:0)||0;if(o.members.length>0||o.methods.length>0||f){let P=g.line(v.x,k+D+x+e,v.x+v.width,k+D+x+e,u);a.insert(()=>P).attr("class","divider").attr("style",p)}if(f||o.members.length>0||o.methods.length>0){let P=g.line(v.x,k+D+$+x+s*2+e,v.x+v.width,k+D+$+x+e+s*2,u);a.insert(()=>P).attr("class","divider").attr("style",p)}if(o.look!=="handDrawn"&&a.selectAll("path").attr("style",p),b.select(":nth-child(2)").attr("style",p),a.selectAll(".divider").select("path").attr("style",p),t.labelStyle?a.selectAll("span").attr("style",t.labelStyle):a.selectAll("span").attr("style",p),!i){let P=RegExp(/color\s*:\s*([^;]*)/),B=P.exec(p);if(B){let F=B[0].replace("color","fill");a.selectAll("tspan").attr("style",F)}else if(n){let F=P.exec(n);if(F){let V=F[0].replace("color","fill");a.selectAll("tspan").attr("style",V)}}}return W(t,b),t.intersect=function(P){return R.rect(t,P)},a})}w(Ge,"classBox");var $a=w(l=>{switch(l){case"Very High":return"red";case"High":return"orange";case"Medium":return null;case"Low":return"blue";case"Very Low":return"lightblue"}},"colorFromPriority");function Fe(e,s,i){return C(this,arguments,function*(l,t,{config:r}){let{labelStyles:o,nodeStyles:a}=H(t);t.labelStyle=o||"";let c=10,n=t.width;t.width=(t.width??200)-10;let{shapeSvg:h,bbox:p,label:f}=yield j(l,t,_(t)),g=t.padding||10,u="",y;"ticket"in t&&t.ticket&&r?.kanban?.ticketBaseUrl&&(u=r?.kanban?.ticketBaseUrl.replace("#TICKET#",t.ticket),y=h.insert("svg:a",":first-child").attr("class","kanban-ticket-link").attr("xlink:href",u).attr("target","_blank"));let m={useHtmlLabels:t.useHtmlLabels,labelStyle:t.labelStyle||"",width:t.width,img:t.img,padding:t.padding||8,centerLabel:!1},d,x;y?{label:d,bbox:x}=yield rs(y,"ticket"in t&&t.ticket||"",m):{label:d,bbox:x}=yield rs(h,"ticket"in t&&t.ticket||"",m);let{label:S,bbox:b}=yield rs(h,"assigned"in t&&t.assigned||"",m);t.width=n;let v=10,k=t?.width||0,D=Math.max(x.height,b.height)/2,$=Math.max(p.height+v*2,t?.height||0)+D,P=-k/2,B=-$/2;f.attr("transform","translate("+(g-k/2)+", "+(-D-p.height/2)+")"),d.attr("transform","translate("+(g-k/2)+", "+(-D+p.height/2)+")"),S.attr("transform","translate("+(g+k/2-b.width-2*c)+", "+(-D+p.height/2)+")");let F,{rx:V,ry:X}=t,{cssStyles:A}=t;if(t.look==="handDrawn"){let I=M.svg(h),N=L(t,{}),G=V||X?I.path(ct(P,B,k,$,V||0),N):I.rectangle(P,B,k,$,N);F=h.insert(()=>G,":first-child"),F.attr("class","basic label-container").attr("style",A||null)}else{F=h.insert("rect",":first-child"),F.attr("class","basic label-container __APA__").attr("style",a).attr("rx",V??5).attr("ry",X??5).attr("x",P).attr("y",B).attr("width",k).attr("height",$);let I="priority"in t&&t.priority;if(I){let N=h.append("line"),G=P+2,O=B+Math.floor((V??0)/2),T=B+$-Math.floor((V??0)/2);N.attr("x1",G).attr("y1",O).attr("x2",G).attr("y2",T).attr("stroke-width","4").attr("stroke",$a(I))}}return W(t,F),t.height=$,t.intersect=function(I){return R.rect(t,I)},h})}w(Fe,"kanbanItem");var Da=[{semanticName:"Process",name:"Rectangle",shortName:"rect",description:"Standard process shape",aliases:["proc","process","rectangle"],internalAliases:["squareRect"],handler:De},{semanticName:"Event",name:"Rounded Rectangle",shortName:"rounded",description:"Represents an event",aliases:["event"],internalAliases:["roundedRect"],handler:ke},{semanticName:"Terminal Point",name:"Stadium",shortName:"stadium",description:"Terminal point",aliases:["terminal","pill"],handler:Pe},{semanticName:"Subprocess",name:"Framed Rectangle",shortName:"fr-rect",description:"Subprocess",aliases:["subprocess","subproc","framed-rectangle","subroutine"],handler:Re},{semanticName:"Database",name:"Cylinder",shortName:"cyl",description:"Database storage",aliases:["db","database","cylinder"],handler:Qs},{semanticName:"Start",name:"Circle",shortName:"circle",description:"Starting point",aliases:["circ"],handler:Gs},{semanticName:"Decision",name:"Diamond",shortName:"diam",description:"Decision-making step",aliases:["decision","diamond","question"],handler:we},{semanticName:"Prepare Conditional",name:"Hexagon",shortName:"hex",description:"Preparation or condition step",aliases:["hexagon","prepare"],handler:ae},{semanticName:"Data Input/Output",name:"Lean Right",shortName:"lean-r",description:"Represents input or output",aliases:["lean-right","in-out"],internalAliases:["lean_right"],handler:fe},{semanticName:"Data Input/Output",name:"Lean Left",shortName:"lean-l",description:"Represents output or input",aliases:["lean-left","out-in"],internalAliases:["lean_left"],handler:pe},{semanticName:"Priority Action",name:"Trapezoid Base Bottom",shortName:"trap-b",description:"Priority action",aliases:["priority","trapezoid-bottom","trapezoid"],handler:He},{semanticName:"Manual Operation",name:"Trapezoid Base Top",shortName:"trap-t",description:"Represents a manual task",aliases:["manual","trapezoid-top","inv-trapezoid"],internalAliases:["inv_trapezoid"],handler:he},{semanticName:"Stop",name:"Double Circle",shortName:"dbl-circ",description:"Represents a stop point",aliases:["double-circle"],internalAliases:["doublecircle"],handler:Us},{semanticName:"Text Block",name:"Text Block",shortName:"text",description:"Text block",handler:Te},{semanticName:"Card",name:"Notched Rectangle",shortName:"notch-rect",description:"Represents a card",aliases:["card","notched-rectangle"],handler:zs},{semanticName:"Lined/Shaded Process",name:"Lined Rectangle",shortName:"lin-rect",description:"Lined process shape",aliases:["lined-rectangle","lined-process","lin-proc","shaded-process"],handler:ve},{semanticName:"Start",name:"Small Circle",shortName:"sm-circ",description:"Small starting point",aliases:["start","small-circle"],internalAliases:["stateStart"],handler:Ne},{semanticName:"Stop",name:"Framed Circle",shortName:"fr-circ",description:"Stop point",aliases:["stop","framed-circle"],internalAliases:["stateEnd"],handler:Be},{semanticName:"Fork/Join",name:"Filled Rectangle",shortName:"fork",description:"Fork or join in process flow",aliases:["join"],internalAliases:["forkJoin"],handler:se},{semanticName:"Collate",name:"Hourglass",shortName:"hourglass",description:"Represents a collate operation",aliases:["hourglass","collate"],handler:re},{semanticName:"Comment",name:"Curly Brace",shortName:"brace",description:"Adds a comment",aliases:["comment","brace-l"],handler:Xs},{semanticName:"Comment Right",name:"Curly Brace",shortName:"brace-r",description:"Adds a comment",handler:Ys},{semanticName:"Comment with braces on both sides",name:"Curly Braces",shortName:"braces",description:"Adds a comment",handler:Vs},{semanticName:"Com Link",name:"Lightning Bolt",shortName:"bolt",description:"Communication link",aliases:["com-link","lightning-bolt"],handler:ue},{semanticName:"Document",name:"Document",shortName:"doc",description:"Represents a document",aliases:["doc","document"],handler:Oe},{semanticName:"Delay",name:"Half-Rounded Rectangle",shortName:"delay",description:"Represents a delay",aliases:["half-rounded-rectangle"],handler:ee},{semanticName:"Direct Access Storage",name:"Horizontal Cylinder",shortName:"h-cyl",description:"Direct access storage",aliases:["das","horizontal-cylinder"],handler:We},{semanticName:"Disk Storage",name:"Lined Cylinder",shortName:"lin-cyl",description:"Disk storage",aliases:["disk","lined-cylinder"],handler:ye},{semanticName:"Display",name:"Curved Trapezoid",shortName:"curv-trap",description:"Represents a display",aliases:["curved-trapezoid","display"],handler:Zs},{semanticName:"Divided Process",name:"Divided Rectangle",shortName:"div-rect",description:"Divided process shape",aliases:["div-proc","divided-rectangle","divided-process"],handler:Js},{semanticName:"Extract",name:"Triangle",shortName:"tri",description:"Extraction process",aliases:["extract","triangle"],handler:Ee},{semanticName:"Internal Storage",name:"Window Pane",shortName:"win-pane",description:"Internal storage",aliases:["internal-storage","window-pane"],handler:ze},{semanticName:"Junction",name:"Filled Circle",shortName:"f-circ",description:"Junction point",aliases:["junction","filled-circle"],handler:Ks},{semanticName:"Loop Limit",name:"Trapezoidal Pentagon",shortName:"notch-pent",description:"Loop limit step",aliases:["loop-limit","notched-pentagon"],handler:Ie},{semanticName:"Manual File",name:"Flipped Triangle",shortName:"flip-tri",description:"Manual file operation",aliases:["manual-file","flipped-triangle"],handler:te},{semanticName:"Manual Input",name:"Sloped Rectangle",shortName:"sl-rect",description:"Manual input step",aliases:["manual-input","sloped-rectangle"],handler:$e},{semanticName:"Multi-Document",name:"Stacked Document",shortName:"docs",description:"Multiple documents",aliases:["documents","st-doc","stacked-document"],handler:xe},{semanticName:"Multi-Process",name:"Stacked Rectangle",shortName:"st-rect",description:"Multiple processes",aliases:["procs","processes","stacked-rectangle"],handler:me},{semanticName:"Stored Data",name:"Bow Tie Rectangle",shortName:"bow-rect",description:"Stored data",aliases:["stored-data","bow-tie-rectangle"],handler:_s},{semanticName:"Summary",name:"Crossed Circle",shortName:"cross-circ",description:"Summary",aliases:["summary","crossed-circle"],handler:qs},{semanticName:"Tagged Document",name:"Tagged Document",shortName:"tag-doc",description:"Tagged document",aliases:["tag-doc","tagged-document"],handler:Ae},{semanticName:"Tagged Process",name:"Tagged Rectangle",shortName:"tag-rect",description:"Tagged process",aliases:["tagged-rectangle","tag-proc","tagged-process"],handler:Le},{semanticName:"Paper Tape",name:"Flag",shortName:"flag",description:"Paper tape",aliases:["paper-tape"],handler:_e},{semanticName:"Odd",name:"Odd",shortName:"odd",description:"Odd shape",internalAliases:["rect_left_inv_arrow"],handler:Se},{semanticName:"Lined Document",name:"Lined Document",shortName:"lin-doc",description:"Lined document",aliases:["lined-document"],handler:de}],Pa=w(()=>{let t=[...Object.entries({state:Ce,choice:js,note:be,rectWithTitle:Me,labelRect:ge,iconSquare:ce,iconCircle:ne,icon:ie,iconRounded:le,imageSquare:oe,anchor:Os,kanbanItem:Fe,classBox:Ge}),...Da.flatMap(r=>[r.shortName,..."aliases"in r?r.aliases:[],..."internalAliases"in r?r.internalAliases:[]].map(s=>[s,r.handler]))];return Object.fromEntries(t)},"generateShapeMap"),qe=Pa();function Ca(l){return l in qe}w(Ca,"isValidShape");var Ht=new Map;function Ba(l,t,r){return C(this,null,function*(){let e,s;t.shape==="rect"&&(t.rx&&t.ry?t.shape="roundedRect":t.shape="squareRect");let i=t.shape?qe[t.shape]:void 0;if(!i)throw new Error(`No such shape: ${t.shape}. Please check your syntax.`);if(t.link){let o;r.config.securityLevel==="sandbox"?o="_top":t.linkTarget&&(o=t.linkTarget||"_blank"),e=l.insert("svg:a").attr("xlink:href",t.link).attr("target",o??null),s=yield i(e,t,r)}else s=yield i(l,t,r),e=s;return t.tooltip&&s.attr("title",t.tooltip),Ht.set(t.id,e),t.haveCallback&&e.attr("class",e.attr("class")+" clickable"),e})}w(Ba,"insertNode");var qr=w((l,t)=>{Ht.set(t.id,l)},"setNodeElem"),Xr=w(()=>{Ht.clear()},"clear"),Yr=w(l=>{let t=Ht.get(l.id);Z.trace("Transforming node",l.diff,l,"translate("+(l.x-l.width/2-5)+", "+l.width/2+")");let r=8,e=l.diff||0;return l.clusterNode?t.attr("transform","translate("+(l.x+e-l.width/2)+", "+(l.y-l.height/2-r)+")"):t.attr("transform","translate("+l.x+", "+l.y+")"),e},"positionNode");export{M as a,j as b,W as c,is as d,_a as e,za as f,Ca as g,Ba as h,qr as i,Xr as j,Yr as k};
